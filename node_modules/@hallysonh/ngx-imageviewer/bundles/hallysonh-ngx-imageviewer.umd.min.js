!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("rxjs"),require("tslib"),require("@angular/platform-browser")):"function"==typeof define&&define.amd?define("@hallysonh/ngx-imageviewer",["exports","@angular/core","rxjs","tslib","@angular/platform-browser"],e):e((t.hallysonh=t.hallysonh||{},t.hallysonh["ngx-imageviewer"]={}),t.ng.core,null,t.tslib,t.ng.platformBrowser)}(this,function(t,e,o,i,n){"use strict";var r=function(){};function s(t,e,o,i){return void 0===o&&(o=0),void 0===i&&(i=!0),{icon:t,tooltip:e,sortId:o,show:i}}var a=new e.InjectionToken("imageviewer.config"),h={width:800,height:600,bgStyle:"#ECEFF1",scaleStep:.1,rotateStepper:!1,loadingMessage:"Loading...",buttonStyle:{iconFontFamily:"Material Icons",alpha:.5,hoverAlpha:.7,bgStyle:"#000000",iconStyle:"#ffffff",borderStyle:"#000000",borderWidth:0},tooltips:{enabled:!0,bgStyle:"#000000",bgAlpha:.5,textStyle:"#ffffff",textAlpha:.9,padding:15,radius:20},nextPageButton:s(String.fromCharCode(58377),"Next page",0),beforePageButton:s(String.fromCharCode(58376),"Previous page",1),zoomOutButton:s(String.fromCharCode(59648),"Zoom out",0),zoomInButton:s(String.fromCharCode(59647),"Zoom in",1),rotateLeftButton:s(String.fromCharCode(58393),"Rotate left",2),rotateRightButton:s(String.fromCharCode(58394),"Rotate right",3),resetButton:s(String.fromCharCode(59491),"Reset",4)},c=function(){function t(t,e){this.style=e,this.sortId=0,this.hover=!1,this.display=!0,this.drawPosition=null,this.drawRadius=0,this.sortId=t.sortId,this.display=t.show,this.icon=t.icon,this.tooltip=t.tooltip}return t.prototype.onClick=function(t){return alert("no click action set!"),!0},t.prototype.onMouseDown=function(t){return!1},t.prototype.draw=function(t,e,o,i){this.drawPosition={x:e,y:o},this.drawRadius=i,t.save();var n="function"==typeof this.hover?this.hover():this.hover;t.globalAlpha=n?this.style.hoverAlpha:this.style.alpha,t.fillStyle=this.style.bgStyle,t.lineWidth=0,t.beginPath(),t.arc(e,o,i,0,2*Math.PI),t.closePath(),t.fill(),0<this.style.borderWidth&&(t.lineWidth=this.style.borderWidth,t.strokeStyle=this.style.borderStyle,t.stroke()),null!==this.icon&&(t.save(),this.drawIconFont(t,e,o,i),t.restore()),t.restore()},t.prototype.drawIconFont=function(t,e,o,i){t.font=i+"px "+this.style.iconFontFamily,t.fillStyle=this.style.iconStyle;var n=e-t.measureText(this.icon).width/2,r=o+i/2;t.fillText(this.icon,n,r)},t.prototype.isWithinBounds=function(t,e){if(null===this.drawPosition)return!1;var o=Math.abs(this.drawPosition.x-t),i=Math.abs(this.drawPosition.y-e);return o*o+i*i<=this.drawRadius*this.drawRadius},t}(),u=function(){function t(){this.viewport={width:0,height:0,scale:1,rotation:0,x:0,y:0},this.minScale=0,this.maxScale=4,this.currentItem=1,this.totalItem=1,this.showItemsQuantity=!1,this.loaded=!1,this.loading=!1,this.rendering=!1,this.resourceChange=new o.Subject}return t.prototype.resetViewport=function(t){if(this.loaded&&t){var e=l(this.viewport?this.viewport.rotation:0)/90%2!=0,o=e?t.height:t.width,i=e?t.width:t.height;i/this._image.height*this._image.width<=o?this.viewport.scale=i/this._image.height:this.viewport.scale=o/this._image.width,this.minScale=this.viewport.scale/4,this.maxScale=4*this.viewport.scale,this.viewport.width=this._image.width*this.viewport.scale,this.viewport.height=this._image.height*this.viewport.scale,this.viewport.x=(t.width-this.viewport.width)/2,this.viewport.y=(t.height-this.viewport.height)/2}},t.prototype.draw=function(t,e,o,i){t.clearRect(0,0,o.width,o.height),t.fillStyle=e.bgStyle,t.fillRect(0,0,o.width,o.height),!this.loading&&this.loaded?(t.translate(this.viewport.x+this.viewport.width/2,this.viewport.y+this.viewport.height/2),t.rotate(this.viewport.rotation*Math.PI/180),t.scale(this.viewport.scale,this.viewport.scale),t.drawImage(this._image,-this._image.width/2,-this._image.height/2)):(t.fillStyle="#333",t.font="25px Verdana",t.textAlign="center",t.fillText(e.loadingMessage||"Loading...",o.width/2,o.height/2)),i(t,e,o)},t.prototype.onResourceChange=function(){return this.resourceChange.asObservable()},t}();function l(t){return(Math.trunc(t/90)+(45<Math.trunc(t%90)?1:0))%4*90}var p=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i.__extends(e,t),e.prototype.setUp=function(){this.loadResource()},e.prototype.loadResource=function(){var e=this;this.loading=!0,this._image=new Image,this._image.addEventListener("load",function(t){e.loaded=!0,e.loading=!1,e.resourceChange.next()},!1),this._image.src=this.src},e}(u),f=function(){function t(){this._cache=[]}return Object.defineProperty(t.prototype,"cache",{get:function(){return this._cache},enumerable:!0,configurable:!0}),t.prototype.getCache=function(e,o){return this.cache.find(function(t){return t.url===e&&t.page===o})},t.prototype.getImage=function(t,e){var o=this.getCache(t,e);return o?o.image:null},t.prototype.saveImage=function(t,e,o){var i=this.getCache(t,e);i?i.image=o:this.cache.push({url:t,page:e,image:o})},t.prototype.disposeCache=function(){this.cache.forEach(function(t){return URL.revokeObjectURL(t.image.src)}),this._cache=[]},t.decorators=[{type:e.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[]},t.ngInjectableDef=e.defineInjectable({factory:function(){return new t},token:t,providedIn:"root"}),t}(),g=function(o){function t(t){var e=o.call(this)||this;return e._imageCache=t,"undefined"!=typeof window&&"Worker"in window&&pdfjsLib&&pdfjsLib.GlobalWorkerOptions&&!pdfjsLib.GlobalWorkerOptions.workerSrc&&(pdfjsLib.GlobalWorkerOptions.workerSrc=pdfjsWorker),e.showItemsQuantity=!0,e}return i.__extends(t,o),t.prototype.setUp=function(){var e=this;if(!e.loading&&e.src){var t=pdfjsLib.getDocument(e.src);e.loading=!0,e.currentItem=1,t.then(function(t){e._pdf=t,e.totalItem=t.numPages,e.loaded=!0,e.loadResource()},function(t){console.error(t)})}},t.prototype.loadResource=function(){var e=this;if(e.loaded){e.loaded=!1;var o=e.src,i=e.currentItem;e._pdf.getPage(i).then(function(t){e._page=t,e.loadImage(o,i,function(){e.loaded=!0,e.loading=!1,e._pendingReload?(e._pendingReload=!1,e.loadResource()):e.resourceChange.next()})})}else e._pendingReload=!0},t.prototype.loadImage=function(o,i,n){var r=this,t=r._imageCache.getImage(o,i);if(t)return r._image=t,void n();var e=document.createElement("canvas"),s=e.getContext("2d"),a=r._page.getViewport(2);e.width=a.width,e.height=a.height;var h={canvasContext:s,viewport:a};r._page.render(h).then(function(){e.toBlob(function(t){var e=new Image;e.onload=n,e.src=URL.createObjectURL(t),r._imageCache.saveImage(o,i,e),r._image=e})})},t}(u),d=function(){function t(t,e,o,i){this._sanitizer=t,this._renderer=e,this._imageCache=o,this.config=i,this._dirty=!0,this._buttons=[],this._currentTooltip=null,this._touchStartState={},this._listenDestroyList=[],this.config=this.extendsDefaultConfig(i),this._nextPageButton=new c(this.config.nextPageButton,this.config.buttonStyle),this._beforePageButton=new c(this.config.beforePageButton,this.config.buttonStyle),this._zoomOutButton=new c(this.config.zoomOutButton,this.config.buttonStyle),this._zoomInButton=new c(this.config.zoomInButton,this.config.buttonStyle),this._rotateLeftButton=new c(this.config.rotateLeftButton,this.config.buttonStyle),this._rotateRightButton=new c(this.config.rotateRightButton,this.config.buttonStyle),this._resetButton=new c(this.config.resetButton,this.config.buttonStyle),this._buttons=[this._zoomOutButton,this._zoomInButton,this._rotateLeftButton,this._rotateRightButton,this._resetButton].filter(function(t){return t.display}).sort(function(t,e){return t.sortId-e.sortId})}return Object.defineProperty(t.prototype,"src",{get:function(){return this._src},set:function(t){t!==this._src&&(this._src=t,this.setUpResource())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"filetype",{get:function(){return this._filetype},set:function(t){t!==this._filetype&&(this._filetype=t,this.setUpResource())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this._width},set:function(t){t!==this._width&&(this._width=t,this._canvas&&(this._canvas.width=this._width),this.resetImage())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},set:function(t){t!==this._height&&(this._height=t,this._canvas&&(this._canvas.height=this._height),this.resetImage())},enumerable:!0,configurable:!0}),t.prototype.ngAfterViewInit=function(){var e=this;this._canvas=this.canvasRef.nativeElement,this._context=this._canvas.getContext("2d"),this._canvas.width=this.width||this.config.width,this._canvas.height=this.height||this.config.height,this._nextPageButton.onClick=function(t){return e.nextPage(),!1},this._beforePageButton.onClick=function(t){return e.previousPage(),!1},this._zoomOutButton.onClick=function(t){return e.zoomOut(),!1},this._zoomInButton.onClick=function(t){return e.zoomIn(),!1},this._rotateLeftButton.onClick=function(t){return e.rotateLeft(),!1},this._rotateRightButton.onClick=function(t){return e.rotateRight(),!1},this._resetButton.onClick=function(t){return e.resetImage(),!1},this.addEventListeners(),this.updateCanvas()},t.prototype.ngOnDestroy=function(){this._listenDestroyList.forEach(function(t){"function"==typeof t&&t()}),this._imageCache.disposeCache()},t.prototype.setUpResource=function(){var t=this;!this.isImage(this.src)||this._resource&&this._resource instanceof p?!this.isPdf(this.src)||this._resource&&this._resource instanceof g||(this._resourceChangeSub&&this._resourceChangeSub.unsubscribe(),this._pdfResource||(this._pdfResource=new g(this._imageCache)),this._resource=this._pdfResource):(this._resourceChangeSub&&this._resourceChangeSub.unsubscribe(),this._imageResource||(this._imageResource=new p),this._resource=this._imageResource),this._resource&&(this._resource.src=this.src instanceof File?URL.createObjectURL(this.src):this.src,this._resourceChangeSub=this._resource.onResourceChange().subscribe(function(){t.updateCanvas(),t.src instanceof File&&URL.revokeObjectURL(t._resource.src)}),this._resource.setUp(),this.resetImage(),this._context&&this.updateCanvas())},t.prototype.onTap=function(t){var e=this.getUIElement(this.screenToCanvasCentre(t.center));null!==e&&e.onClick(t)},t.prototype.onTouchEnd=function(){this._touchStartState.viewport=undefined,this._touchStartState.scale=undefined,this._touchStartState.rotate=undefined},t.prototype.processTouchEvent=function(t){this._touchStartState.viewport||(this._touchStartState.viewport=Object.assign({},this._resource.viewport));var e=this._resource.viewport;e.x=this._touchStartState.viewport.x+t.deltaX,e.y=this._touchStartState.viewport.y+t.deltaY,this._touchStartState.scale||(this._touchStartState.scale=this._resource.viewport.scale);var o=this._touchStartState.scale*t.scale;if(e.scale=o>this._resource.maxScale?this._resource.maxScale:o<this._resource.minScale?this._resource.minScale:o,this._touchStartState.rotate||(this._touchStartState.rotate={rotation:e.rotation,startRotate:t.rotation}),0!==t.rotation){var i=this._touchStartState.rotate.rotation+t.rotation-this._touchStartState.rotate.startRotate;e.rotation=this.config.rotateStepper?l(i):i}this._dirty=!0},t.prototype.addEventListeners=function(){var e=this;this._listenDestroyList.push(this._renderer.listen(this._canvas,"DOMMouseScroll",function(t){return e.onMouseWheel(t)})),this._listenDestroyList.push(this._renderer.listen(this._canvas,"mousewheel",function(t){return e.onMouseWheel(t)})),this._listenDestroyList.push(this._renderer.listen(this._canvas,"mousemove",function(t){return e.checkTooltipActivation(e.screenToCanvasCentre({x:t.clientX,y:t.clientY}))}))},t.prototype.onMouseWheel=function(t){t||(t=event),t.preventDefault(),t.detail<0||0<t.wheelDelta?this.zoomIn():this.zoomOut()},t.prototype.checkTooltipActivation=function(t){this.getUIElements().forEach(function(t){return t.hover=!1});var e=this.getUIElement(t),o=this._currentTooltip;null!==e&&("undefined"!=typeof e.hover&&(e.hover=!0),"undefined"!=typeof e.tooltip&&(this._currentTooltip=e.tooltip)),o!==this._currentTooltip&&(this._dirty=!0)},t.prototype.nextPage=function(){this._resource&&(this._resource.currentItem>=this._resource.totalItem||(this._resource.currentItem<1&&(this._resource.currentItem=0),this._resource.currentItem++,this._resource.loadResource(),this._dirty=!0))},t.prototype.previousPage=function(){this._resource&&(this._resource.currentItem<=1||(this._resource.currentItem>this._resource.totalItem&&(this._resource.currentItem=this._resource.totalItem+1),this._resource.currentItem--,this._resource.loadResource(),this._dirty=!0))},t.prototype.zoomIn=function(){if(this._resource){var t=this._resource.viewport.scale*(1+this.config.scaleStep);this._resource.viewport.scale=t>this._resource.maxScale?this._resource.maxScale:t,this._dirty=!0}},t.prototype.zoomOut=function(){if(this._resource){var t=this._resource.viewport.scale*(1-this.config.scaleStep);this._resource.viewport.scale=t<this._resource.minScale?this._resource.minScale:t,this._dirty=!0}},t.prototype.rotateLeft=function(){if(this._resource){var t=this._resource.viewport;t.rotation=0===t.rotation?270:t.rotation-90,this._dirty=!0}},t.prototype.rotateRight=function(){if(this._resource){var t=this._resource.viewport;t.rotation=270===t.rotation?0:t.rotation+90,this._dirty=!0}},t.prototype.resetImage=function(){this._resource&&(this._resource.resetViewport(this._canvas),this._dirty=!0)},t.prototype.updateCanvas=function(){this.resetImage(),this.render()},t.prototype.render=function(){var t=this,e=this;if(this._dirty&&this._resource){this._dirty=!1;var o=this._context;o.save(),this._resource.draw(o,this.config,this._canvas,function(){o.restore(),e._resource.loaded&&(t.drawButtons(o),t._resource.showItemsQuantity&&t.drawPaginator(o))})}requestAnimationFrame(function(){return t.render()})},t.prototype.drawButtons=function(t){for(var e=this.config.tooltips.padding,o=this.config.tooltips.radius,i=2*o+e,n=this._canvas.width-o-e,r=this._canvas.height-o-e,s=0;s<this._buttons.length;s++)this._buttons[s].draw(t,n,r-i*s,o);if(null!==this._currentTooltip&&500<this._canvas.width){t.save();var a=o;t.font=a+"px sans-serif";var h=t.measureText(this._currentTooltip).width+e,c=.7*a+e,u=this._canvas.width-(2*o+2*e)-h,l=this._canvas.height-c-e,p=u+.5*e,f=this._canvas.height-1.5*e;t.globalAlpha=this.config.tooltips.bgAlpha,t.fillStyle=this.config.tooltips.bgStyle,this.drawRoundRectangle(t,u,l,h,c,8,!0,!1),t.globalAlpha=this.config.tooltips.textAlpha,t.fillStyle=this.config.tooltips.textStyle,t.fillText(this._currentTooltip,p,f),t.restore()}},t.prototype.drawPaginator=function(t){var e=this.config.tooltips.padding,o=this.config.tooltips.radius,i=(this._canvas.width-50)/2-o-e,n=this._canvas.width/2,r=(this._canvas.width+50)/2+o+e,s=this._canvas.height-o-e,a=this._resource.currentItem+"/"+this._resource.totalItem;t.save(),this._beforePageButton.draw(t,i,s,o),this._nextPageButton.draw(t,r,s,o),t.restore(),t.save(),t.font="25px Verdana",t.textAlign="center",t.fillText(a,n,this._canvas.height-e-12.5,50),t.restore()},t.prototype.drawRoundRectangle=function(t,e,o,i,n,r,s,a){r="number"==typeof r?r:5,s="boolean"!=typeof s||s,a="boolean"==typeof a&&a,t.beginPath(),t.moveTo(e+r,o),t.lineTo(e+i-r,o),t.quadraticCurveTo(e+i,o,e+i,o+r),t.lineTo(e+i,o+n-r),t.quadraticCurveTo(e+i,o+n,e+i-r,o+n),t.lineTo(e+r,o+n),t.quadraticCurveTo(e,o+n,e,o+n-r),t.lineTo(e,o+r),t.quadraticCurveTo(e,o,e+r,o),t.closePath(),s&&t.fill(),a&&t.stroke()},t.prototype.extendsDefaultConfig=function(t){var e=h,o=Object.assign({},e,t);return t.buttonStyle&&(o.buttonStyle=Object.assign(e.buttonStyle,t.buttonStyle)),t.tooltips&&(o.tooltips=Object.assign(e.tooltips,t.tooltips)),t.nextPageButton&&(o.nextPageButton=Object.assign(e.nextPageButton,t.nextPageButton)),t.beforePageButton&&(o.beforePageButton=Object.assign(e.beforePageButton,t.beforePageButton)),t.zoomOutButton&&(o.zoomOutButton=Object.assign(e.zoomOutButton,t.zoomOutButton)),t.zoomOutButton&&(o.zoomOutButton=Object.assign(e.zoomOutButton,t.zoomOutButton)),t.zoomInButton&&(o.zoomInButton=Object.assign(e.zoomInButton,t.zoomInButton)),t.rotateLeftButton&&(o.rotateLeftButton=Object.assign(e.rotateLeftButton,t.rotateLeftButton)),t.rotateRightButton&&(o.rotateRightButton=Object.assign(e.rotateRightButton,t.rotateRightButton)),t.resetButton&&(o.resetButton=Object.assign(e.resetButton,t.resetButton)),o},t.prototype.screenToCanvasCentre=function(t){var e=this._canvas.getBoundingClientRect();return{x:t.x-e.left,y:t.y-e.top}},t.prototype.getUIElements=function(){var t=this._buttons.slice();return t.push(this._nextPageButton),t.push(this._beforePageButton),t},t.prototype.getUIElement=function(e){var t=this.getUIElements().filter(function(t){return t.isWithinBounds(e.x,e.y)});return 0<t.length?t[0]:null},t.prototype.isImage=function(t){return!(!this._filetype||"image"!==this._filetype.toLowerCase())||_(t,"\\.(png|jpg|jpeg|gif)|image/png")},t.prototype.isPdf=function(t){return!(!this._filetype||"pdf"!==this._filetype.toLowerCase())||_(t,"\\.(pdf)|application/pdf")},t.decorators=[{type:e.Component,args:[{selector:"ngx-imageviewer",template:'\n    <canvas #imageContainer [width]="width" [height]="height"\n      (tap)="onTap($event)" (pinchin)="processTouchEvent($event)" (pinchout)="processTouchEvent($event)"\n      (panmove)="processTouchEvent($event)" (panend)="onTouchEnd()" (rotatemove)="processTouchEvent($event)"\n        (rotateend)="onTouchEnd()">\n    </canvas>\n  ',styles:["\n    :host { display: block }\n    :host canvas { margin: 0 auto; display: block }\n    [hidden] { display: none !important }\n  "]}]}],t.ctorParameters=function(){return[{type:n.DomSanitizer},{type:e.Renderer2},{type:f},{type:r,decorators:[{type:e.Inject,args:[a]}]}]},t.propDecorators={src:[{type:e.Input,args:["src"]}],filetype:[{type:e.Input,args:["filetype"]}],width:[{type:e.Input,args:["width"]}],height:[{type:e.Input,args:["height"]}],canvasRef:[{type:e.ViewChild,args:["imageContainer"]}]},t}();function _(t,e){return!!t&&null!==(t instanceof File?t.name:t).toLowerCase().match(e)}var v=h,y=function(){function t(){}return t.decorators=[{type:e.NgModule,args:[{providers:[{provide:a,useValue:v}],declarations:[d],exports:[d]}]}],t}();t.ImageViewerModule=y,t.ImageViewerConfig=r,t.createButtonConfig=s,t.IMAGEVIEWER_CONFIG=a,t.ɵc=f,t.ɵb=d,t.ɵa=h,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=hallysonh-ngx-imageviewer.umd.min.js.map