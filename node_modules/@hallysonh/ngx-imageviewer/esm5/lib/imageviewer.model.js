/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
import { Subject } from 'rxjs';
var Button = /** @class */ (function () {
    //#endregion
    //#region Lifecycle events
    function Button(config, style) {
        this.style = style;
        //#region Properties
        this.sortId = 0;
        // hover state
        this.hover = false;
        // show/hide button
        this.display = true;
        this.drawPosition = null;
        this.drawRadius = 0;
        this.sortId = config.sortId;
        this.display = config.show;
        this.icon = config.icon;
        this.tooltip = config.tooltip;
    }
    //#endregion
    //#region Events
    // click action
    /**
     * @param {?} evt
     * @return {?}
     */
    Button.prototype.onClick = /**
     * @param {?} evt
     * @return {?}
     */
    function (evt) { alert('no click action set!'); return true; };
    // mouse down action
    /**
     * @param {?} evt
     * @return {?}
     */
    Button.prototype.onMouseDown = /**
     * @param {?} evt
     * @return {?}
     */
    function (evt) { return false; };
    //#endregion
    //#region Draw Button
    /**
     * @param {?} ctx
     * @param {?} x
     * @param {?} y
     * @param {?} radius
     * @return {?}
     */
    Button.prototype.draw = /**
     * @param {?} ctx
     * @param {?} x
     * @param {?} y
     * @param {?} radius
     * @return {?}
     */
    function (ctx, x, y, radius) {
        this.drawPosition = { x: x, y: y };
        this.drawRadius = radius;
        // preserve context
        ctx.save();
        // drawing settings
        var /** @type {?} */ isHover = (typeof this.hover === 'function') ? this.hover() : this.hover;
        ctx.globalAlpha = (isHover) ? this.style.hoverAlpha : this.style.alpha;
        ctx.fillStyle = this.style.bgStyle;
        ctx.lineWidth = 0;
        // draw circle
        ctx.beginPath();
        ctx.arc(x, y, radius, 0, 2 * Math.PI);
        ctx.closePath();
        ctx.fill();
        if (this.style.borderWidth > 0) {
            ctx.lineWidth = this.style.borderWidth;
            ctx.strokeStyle = this.style.borderStyle;
            ctx.stroke();
        }
        // draw icon
        if (this.icon !== null) {
            ctx.save();
            // ctx.globalCompositeOperation = 'destination-out';
            this.drawIconFont(ctx, x, y, radius);
            ctx.restore();
        }
        // restore context
        ctx.restore();
    };
    /**
     * @param {?} ctx
     * @param {?} centreX
     * @param {?} centreY
     * @param {?} size
     * @return {?}
     */
    Button.prototype.drawIconFont = /**
     * @param {?} ctx
     * @param {?} centreX
     * @param {?} centreY
     * @param {?} size
     * @return {?}
     */
    function (ctx, centreX, centreY, size) {
        // font settings
        ctx.font = size + 'px ' + this.style.iconFontFamily;
        ctx.fillStyle = this.style.iconStyle;
        // calculate position
        var /** @type {?} */ textSize = ctx.measureText(this.icon);
        var /** @type {?} */ x = centreX - textSize.width / 2;
        var /** @type {?} */ y = centreY + size / 2;
        // draw it
        ctx.fillText(this.icon, x, y);
    };
    //#endregion
    //#region Utils
    /**
     * @param {?} x
     * @param {?} y
     * @return {?}
     */
    Button.prototype.isWithinBounds = /**
     * @param {?} x
     * @param {?} y
     * @return {?}
     */
    function (x, y) {
        if (this.drawPosition === null) {
            return false;
        }
        var /** @type {?} */ dx = Math.abs(this.drawPosition.x - x), /** @type {?} */ dy = Math.abs(this.drawPosition.y - y);
        return dx * dx + dy * dy <= this.drawRadius * this.drawRadius;
    };
    return Button;
}());
export { Button };
function Button_tsickle_Closure_declarations() {
    /** @type {?} */
    Button.prototype.sortId;
    /** @type {?} */
    Button.prototype.icon;
    /** @type {?} */
    Button.prototype.tooltip;
    /** @type {?} */
    Button.prototype.hover;
    /** @type {?} */
    Button.prototype.display;
    /** @type {?} */
    Button.prototype.drawPosition;
    /** @type {?} */
    Button.prototype.drawRadius;
    /** @type {?} */
    Button.prototype.style;
}
var Viewport = /** @class */ (function () {
    function Viewport(width, height, scale, rotation, x, y) {
        this.width = width;
        this.height = height;
        this.scale = scale;
        this.rotation = rotation;
        this.x = x;
        this.y = y;
    }
    return Viewport;
}());
export { Viewport };
function Viewport_tsickle_Closure_declarations() {
    /** @type {?} */
    Viewport.prototype.width;
    /** @type {?} */
    Viewport.prototype.height;
    /** @type {?} */
    Viewport.prototype.scale;
    /** @type {?} */
    Viewport.prototype.rotation;
    /** @type {?} */
    Viewport.prototype.x;
    /** @type {?} */
    Viewport.prototype.y;
}
/**
 * @record
 */
export function Dimension() { }
function Dimension_tsickle_Closure_declarations() {
    /** @type {?} */
    Dimension.prototype.width;
    /** @type {?} */
    Dimension.prototype.height;
}
/**
 * @abstract
 */
var /**
 * @abstract
 */
ResourceLoader = /** @class */ (function () {
    function ResourceLoader() {
        this.viewport = { width: 0, height: 0, scale: 1, rotation: 0, x: 0, y: 0 };
        this.minScale = 0;
        this.maxScale = 4;
        this.currentItem = 1;
        this.totalItem = 1;
        this.showItemsQuantity = false;
        this.loaded = false;
        this.loading = false;
        this.rendering = false;
        this.resourceChange = new Subject();
    }
    /**
     * @param {?} canvasDim
     * @return {?}
     */
    ResourceLoader.prototype.resetViewport = /**
     * @param {?} canvasDim
     * @return {?}
     */
    function (canvasDim) {
        if (!this.loaded || !canvasDim) {
            return;
        }
        var /** @type {?} */ rotation = this.viewport ? this.viewport.rotation : 0;
        var /** @type {?} */ inverted = toSquareAngle(rotation) / 90 % 2 !== 0;
        var /** @type {?} */ canvas = {
            width: !inverted ? canvasDim.width : canvasDim.height,
            height: !inverted ? canvasDim.height : canvasDim.width
        };
        if (((canvas.height / this._image.height) * this._image.width) <= canvas.width) {
            this.viewport.scale = canvas.height / this._image.height;
        }
        else {
            this.viewport.scale = canvas.width / this._image.width;
        }
        this.minScale = this.viewport.scale / 4;
        this.maxScale = this.viewport.scale * 4;
        // start point to draw image
        this.viewport.width = this._image.width * this.viewport.scale;
        this.viewport.height = this._image.height * this.viewport.scale;
        this.viewport.x = (canvasDim.width - this.viewport.width) / 2;
        this.viewport.y = (canvasDim.height - this.viewport.height) / 2;
    };
    /**
     * @param {?} ctx
     * @param {?} config
     * @param {?} canvasDim
     * @param {?} onFinish
     * @return {?}
     */
    ResourceLoader.prototype.draw = /**
     * @param {?} ctx
     * @param {?} config
     * @param {?} canvasDim
     * @param {?} onFinish
     * @return {?}
     */
    function (ctx, config, canvasDim, onFinish) {
        // clear canvas
        ctx.clearRect(0, 0, canvasDim.width, canvasDim.height);
        // Draw background color;
        ctx.fillStyle = config.bgStyle;
        ctx.fillRect(0, 0, canvasDim.width, canvasDim.height);
        // draw image (transformed, rotate and scaled)
        if (!this.loading && this.loaded) {
            ctx.translate(this.viewport.x + this.viewport.width / 2, this.viewport.y + this.viewport.height / 2);
            ctx.rotate(this.viewport.rotation * Math.PI / 180);
            ctx.scale(this.viewport.scale, this.viewport.scale);
            ctx.drawImage(this._image, -this._image.width / 2, -this._image.height / 2);
        }
        else {
            ctx.fillStyle = '#333';
            ctx.font = '25px Verdana';
            ctx.textAlign = 'center';
            ctx.fillText(config.loadingMessage || 'Loading...', canvasDim.width / 2, canvasDim.height / 2);
        }
        onFinish(ctx, config, canvasDim);
    };
    /**
     * @return {?}
     */
    ResourceLoader.prototype.onResourceChange = /**
     * @return {?}
     */
    function () { return this.resourceChange.asObservable(); };
    return ResourceLoader;
}());
/**
 * @abstract
 */
export { ResourceLoader };
function ResourceLoader_tsickle_Closure_declarations() {
    /** @type {?} */
    ResourceLoader.prototype.src;
    /** @type {?} */
    ResourceLoader.prototype.sourceDim;
    /** @type {?} */
    ResourceLoader.prototype.viewport;
    /** @type {?} */
    ResourceLoader.prototype.minScale;
    /** @type {?} */
    ResourceLoader.prototype.maxScale;
    /** @type {?} */
    ResourceLoader.prototype.currentItem;
    /** @type {?} */
    ResourceLoader.prototype.totalItem;
    /** @type {?} */
    ResourceLoader.prototype.showItemsQuantity;
    /** @type {?} */
    ResourceLoader.prototype.loaded;
    /** @type {?} */
    ResourceLoader.prototype.loading;
    /** @type {?} */
    ResourceLoader.prototype.rendering;
    /** @type {?} */
    ResourceLoader.prototype._image;
    /** @type {?} */
    ResourceLoader.prototype.resourceChange;
    /**
     * @abstract
     * @return {?}
     */
    ResourceLoader.prototype.setUp = function () { };
    /**
     * @abstract
     * @return {?}
     */
    ResourceLoader.prototype.loadResource = function () { };
}
/**
 * @param {?} angle
 * @return {?}
 */
export function toSquareAngle(angle) {
    return 90 * ((Math.trunc(angle / 90) + (Math.trunc(angle % 90) > 45 ? 1 : 0)) % 4);
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW1hZ2V2aWV3ZXIubW9kZWwuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AaGFsbHlzb25oL25neC1pbWFnZXZpZXdlci8iLCJzb3VyY2VzIjpbImxpYi9pbWFnZXZpZXdlci5tb2RlbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQ0EsT0FBTyxFQUFjLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUUzQyxJQUFBO0lBZ0JFLFlBQVk7SUFFWiwwQkFBMEI7SUFDMUIsZ0JBQ0UsTUFBb0IsRUFDWjtRQUFBLFVBQUssR0FBTCxLQUFLOztzQkFuQk4sQ0FBQzs7cUJBTXlCLEtBQUs7O3VCQUc5QixJQUFJOzRCQUdTLElBQUk7MEJBQ04sQ0FBQztRQVFwQixJQUFJLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUM7UUFDNUIsSUFBSSxDQUFDLE9BQU8sR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDO1FBQzNCLElBQUksQ0FBQyxJQUFJLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQztRQUN4QixJQUFJLENBQUMsT0FBTyxHQUFHLE1BQU0sQ0FBQyxPQUFPLENBQUM7S0FDL0I7SUFDRCxZQUFZO0lBRVosZ0JBQWdCO0lBQ2hCLGVBQWU7Ozs7O0lBQ2Ysd0JBQU87Ozs7SUFBUCxVQUFRLEdBQUcsSUFBSSxLQUFLLENBQUMsc0JBQXNCLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsRUFBRTtJQUU1RCxvQkFBb0I7Ozs7O0lBQ3BCLDRCQUFXOzs7O0lBQVgsVUFBWSxHQUFHLElBQUksTUFBTSxDQUFDLEtBQUssQ0FBQyxFQUFFO0lBQ2xDLFlBQVk7SUFFWixxQkFBcUI7Ozs7Ozs7O0lBQ3JCLHFCQUFJOzs7Ozs7O0lBQUosVUFBSyxHQUFHLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxNQUFNO1FBQ3BCLElBQUksQ0FBQyxZQUFZLEdBQUcsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQztR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LHFCQUFNLFFBQVEsR0FBRyxhQUFhLENBQUMsUUFBUSxDQUFDLEdBQUcsRUFBRSxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDeEQscUJBQU0sTUFBTSxHQUFHO1lBQ2IsS0FBSyxFQUFFLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsTUFBTTtZQUNyRCxNQUFNLEVBQUUsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxLQUFLO1NBQ3ZELENBQUM7UUFFRixFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLElBQUksTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7WUFDL0UsSUFBSSxDQUFDLFFBQVEsQ0FBQyxLQUFLLEdBQUcsTUFBTSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQztTQUMxRDtRQUFDLElBQUksQ0FBQyxDQUFDO1lBQ04sSUFBSSxDQUFDLFFBQVEsQ0FBQyxLQUFLLEdBQUcsTUFBTSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQztTQUN4RDtRQUNELElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDO1FBQ3hDLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDOztRQUd4QyxJQUFJLENBQUMsUUFBUSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQztRQUM5RCxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sR0FBRyxJQUFJLENB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QUFHLENBQUMsQ0FBQyxDQUFDO0NBQ3BGIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQnV0dG9uQ29uZmlnLCBCdXR0b25TdHlsZSwgSW1hZ2VWaWV3ZXJDb25maWcgfSBmcm9tICcuL2ltYWdldmlld2VyLmNvbmZpZyc7XHJcbmltcG9ydCB7IE9ic2VydmFibGUsIFN1YmplY3QgfSBmcm9tICdyeGpzJztcclxuXHJcbmV4cG9ydCBjbGFzcyBCdXR0b24ge1xyXG4gIC8vI3JlZ2lvbiBQcm9wZXJ0aWVzXHJcbiAgc29ydElkID0gMDtcclxuXHJcbiAgaWNvbjogc3RyaW5nO1xyXG4gIHRvb2x0aXA6IHN0cmluZztcclxuXHJcbiAgLy8gaG92ZXIgc3RhdGVcclxuICBob3ZlcjogYm9vbGVhbiB8ICgoKSA9PiBib29sZWFuKSA9IGZhbHNlO1xyXG5cclxuICAvLyBzaG93L2hpZGUgYnV0dG9uXHJcbiAgZGlzcGxheSA9IHRydWU7XHJcblxyXG4gIC8vIGRyYXduIG9uIHBvc2l0aW9uXHJcbiAgcHJpdmF0ZSBkcmF3UG9zaXRpb24gPSBudWxsO1xyXG4gIHByaXZhdGUgZHJhd1JhZGl1cyA9IDA7XHJcbiAgLy8jZW5kcmVnaW9uXHJcblxyXG4gIC8vI3JlZ2lvbiBMaWZlY3ljbGUgZXZlbnRzXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBjb25maWc6IEJ1dHRvbkNvbmZpZyxcclxuICAgIHByaXZhdGUgc3R5bGU6IEJ1dHRvblN0eWxlXHJcbiAgKSB7XHJcbiAgICB0aGlzLnNvcnRJZCA9IGNvbmZpZy5zb3J0SWQ7XHJcbiAgICB0aGlzLmRpc3BsYXkgPSBjb25maWcuc2hvdztcclxuICAgIHRoaXMuaWNvbiA9IGNvbmZpZy5pY29uO1xyXG4gICAgdGhpcy50b29sdGlwID0gY29uZmlnLnRvb2x0aXA7XHJcbiAgfVxyXG4gIC8vI2VuZHJlZ2lvblxyXG5cclxuICAvLyNyZWdpb24gRXZlbnRzXHJcbiAgLy8gY2xpY2sgYWN0aW9uXHJcbiAgb25DbGljayhldnQpIHsgYWxlcnQoJ25vIGNsaWNrIGFjdGlvbiBzZXQhJyk7IHJldHVybiB0cnVlOyB9XHJcblxyXG4gIC8vIG1vdXNlIGRvd24gYWN0aW9uXHJcbiAgb25Nb3VzZURvd24oZXZ0KSB7IHJldHVybiBmYWxzZTsgfVxyXG4gIC8vI2VuZHJlZ2lvblxyXG5cclxuICAvLyNyZWdpb24gRHJhdyBCdXR0b25cclxuICBkcmF3KGN0eCwgeCwgeSwgcmFkaXVzKSB7XHJcbiAgICB0aGlzLmRyYXdQb3NpdGlvbiA9IHsgeDogeCwgeTogeSB9O1xyXG4gICAgdGhpcy5kcmF3UmFkaXVzID0gcmFkaXVzO1xyXG5cclxuICAgIC8vIHByZXNlcnZlIGNvbnRleHRcclxuICAgIGN0eC5zYXZlKCk7XHJcblxyXG4gICAgLy8gZHJhd2luZyBzZXR0aW5nc1xyXG4gICAgY29uc3QgaXNIb3ZlciA9ICh0eXBlb2YgdGhpcy5ob3ZlciA9PT0gJ2Z1bmN0aW9uJykgPyB0aGlzLmhvdmVyKCkgOiB0aGlzLmhvdmVyO1xyXG4gICAgY3R4Lmdsb2JhbEFscGhhID0gKGlzSG92ZXIpID8gdGhpcy5zdHlsZS5ob3ZlckFscGhhIDogdGhpcy5zdHlsZS5hbHBoYTtcclxuICAgIGN0eC5maWxsU3R5bGUgPSB0aGlzLnN0eWxlLmJnU3R5bGU7XHJcbiAgICBjdHgubGluZVdpZHRoID0gMDtcclxuXHJcbiAgICAvLyBkcmF3IGNpcmNsZVxyXG4gICAgY3R4LmJlZ2luUGF0aCgpO1xyXG4gICAgY3R4LmFyYyh4LCB5LCByYWRpdXMsIDAsIDIgKiBNYXRoLlBJKTtcclxuICAgIGN0eC5jbG9zZVBhdGgoKTtcclxuICAgIGN0eC5maWxsKCk7XHJcbiAgICBpZiAodGhpcy5zdHlsZS5ib3JkZXJXaWR0aCA+IDApIHtcclxuICAgICAgY3R4LmxpbmVXaWR0aCA9IHRoaXMuc3R5bGUuYm9yZGVyV2lkdGg7XHJcbiAgICAgIGN0eC5zdHJva2VTdHlsZSA9IHRoaXMuc3R5bGUuYm9yZGVyU3R5bGU7XHJcbiAgICAgIGN0eC5zdHJva2UoKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBkcmF3IGljb25cclxuICAgIGlmICh0aGlzLmljb24gIT09IG51bGwpIHtcclxuICAgICAgY3R4LnNhdmUoKTtcclxuICAgICAgLy8gY3R4Lmdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbiA9ICdkZXN0aW5hdGlvbi1vdXQnO1xyXG4gICAgICB0aGlzLmRyYXdJY29uRm9udChjdHgsIHgsIHksIHJhZGl1cyk7XHJcbiAgICAgIGN0eC5yZXN0b3JlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gcmVzdG9yZSBjb250ZXh0XHJcbiAgICBjdHgucmVzdG9yZSgpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBkcmF3SWNvbkZvbnQoY3R4LCBjZW50cmVYLCBjZW50cmVZLCBzaXplKSB7XHJcbiAgICAvLyBmb250IHNldHRpbmdzXHJcbiAgICBjdHguZm9udCA9IHNpemUgKyAncHggJyArIHRoaXMuc3R5bGUuaWNvbkZvbnRGYW1pbHk7XHJcbiAgICBjdHguZmlsbFN0eWxlID0gdGhpcy5zdHlsZS5pY29uU3R5bGU7XHJcblxyXG4gICAgLy8gY2FsY3VsYXRlIHBvc2l0aW9uXHJcbiAgICBjb25zdCB0ZXh0U2l6ZSA9IGN0eC5tZWFzdXJlVGV4dCh0aGlzLmljb24pO1xyXG4gICAgY29uc3QgeCA9IGNlbnRyZVggLSB0ZXh0U2l6ZS53aWR0aCAvIDI7XHJcbiAgICBjb25zdCB5ID0gY2VudHJlWSArIHNpemUgLyAyO1xyXG5cclxuICAgIC8vIGRyYXcgaXRcclxuICAgIGN0eC5maWxsVGV4dCh0aGlzLmljb24sIHgsIHkpO1xyXG4gIH1cclxuICAvLyNlbmRyZWdpb25cclxuXHJcbiAgLy8jcmVnaW9uIFV0aWxzXHJcbiAgaXNXaXRoaW5Cb3VuZHMoeCwgeSkge1xyXG4gICAgaWYgKHRoaXMuZHJhd1Bvc2l0aW9uID09PSBudWxsKSB7IHJldHVybiBmYWxzZTsgfVxyXG4gICAgY29uc3QgZHggPSBNYXRoLmFicyh0aGlzLmRyYXdQb3NpdGlvbi54IC0geCksIGR5ID0gTWF0aC5hYnModGhpcy5kcmF3UG9zaXRpb24ueSAtIHkpO1xyXG4gICAgcmV0dXJuIGR4ICogZHggKyBkeSAqIGR5IDw9IHRoaXMuZHJhd1JhZGl1cyAqIHRoaXMuZHJhd1JhZGl1cztcclxuICB9XHJcbiAgLy8jZW5kcmVnaW9uXHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBWaWV3cG9ydCB7XHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwdWJsaWMgd2lkdGg6IG51bWJlcixcclxuICAgIHB1YmxpYyBoZWlnaHQ6IG51bWJlcixcclxuICAgIHB1YmxpYyBzY2FsZTogbnVtYmVyLFxyXG4gICAgcHVibGljIHJvdGF0aW9uOiBudW1iZXIsXHJcbiAgICBwdWJsaWMgeDogbnVtYmVyLFxyXG4gICAgcHVibGljIHk6IG51bWJlclxyXG4gICkge31cclxufVxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBEaW1lbnNpb24geyB3aWR0aDogbnVtYmVyOyBoZWlnaHQ6IG51bWJlcjsgfVxyXG5cclxuZXhwb3J0IGFic3RyYWN0IGNsYXNzIFJlc291cmNlTG9hZGVyIHtcclxuICBwdWJsaWMgc3JjOiBzdHJpbmc7XHJcbiAgcHVibGljIHNvdXJjZURpbTogeyB3aWR0aDogbnVtYmVyLCBoZWlnaHQ6IG51bWJlciB9O1xyXG4gIHB1YmxpYyB2aWV3cG9ydDogVmlld3BvcnQgPSB7IHdpZHRoOiAwLCBoZWlnaHQ6IDAsIHNjYWxlOiAxLCByb3RhdGlvbjogMCwgeDogMCwgeTogMCB9O1xyXG4gIHB1YmxpYyBtaW5TY2FsZSA9IDA7XHJcbiAgcHVibGljIG1heFNjYWxlID0gNDtcclxuICBwdWJsaWMgY3VycmVudEl0ZW0gPSAxO1xyXG4gIHB1YmxpYyB0b3RhbEl0ZW0gPSAxO1xyXG4gIHB1YmxpYyBzaG93SXRlbXNRdWFudGl0eSA9IGZhbHNlO1xyXG4gIHB1YmxpYyBsb2FkZWQgPSBmYWxzZTtcclxuICBwdWJsaWMgbG9hZGluZyA9IGZhbHNlO1xyXG4gIHB1YmxpYyByZW5kZXJpbmcgPSBmYWxzZTtcclxuXHJcbiAgcHJvdGVjdGVkIF9pbWFnZTtcclxuICBwcm90ZWN0ZWQgcmVzb3VyY2VDaGFuZ2UgPSBuZXcgU3ViamVjdDxzdHJpbmc+KCk7XHJcblxyXG4gIGFic3RyYWN0IHNldFVwKCk7XHJcbiAgYWJzdHJhY3QgbG9hZFJlc291cmNlKCk7XHJcblxyXG4gIHB1YmxpYyByZXNldFZpZXdwb3J0KGNhbnZhc0RpbTogRGltZW5zaW9uKTogYm9vbGVhbiB7XHJcbiAgICBpZiAoIXRoaXMubG9hZGVkIHx8ICFjYW52YXNEaW0pIHsgcmV0dXJuOyB9XHJcblxyXG4gICAgY29uc3Qgcm90YXRpb24gPSB0aGlzLnZpZXdwb3J0ID8gdGhpcy52aWV3cG9ydC5yb3RhdGlvbiA6IDA7XHJcbiAgICBjb25zdCBpbnZlcnRlZCA9IHRvU3F1YXJlQW5nbGUocm90YXRpb24pIC8gOTAgJSAyICE9PSAwO1xyXG4gICAgY29uc3QgY2FudmFzID0ge1xyXG4gICAgICB3aWR0aDogIWludmVydGVkID8gY2FudmFzRGltLndpZHRoIDogY2FudmFzRGltLmhlaWdodCxcclxuICAgICAgaGVpZ2h0OiAhaW52ZXJ0ZWQgPyBjYW52YXNEaW0uaGVpZ2h0IDogY2FudmFzRGltLndpZHRoXHJcbiAgICB9O1xyXG5cclxuICAgIGlmICgoKGNhbnZhcy5oZWlnaHQgLyB0aGlzLl9pbWFnZS5oZWlnaHQpICogdGhpcy5faW1hZ2Uud2lkdGgpIDw9IGNhbnZhcy53aWR0aCkge1xyXG4gICAgICB0aGlzLnZpZXdwb3J0LnNjYWxlID0gY2FudmFzLmhlaWdodCAvIHRoaXMuX2ltYWdlLmhlaWdodDtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMudmlld3BvcnQuc2NhbGUgPSBjYW52YXMud2lkdGggLyB0aGlzLl9pbWFnZS53aWR0aDtcclxuICAgIH1cclxuICAgIHRoaXMubWluU2NhbGUgPSB0aGlzLnZpZXdwb3J0LnNjYWxlIC8gNDtcclxuICAgIHRoaXMubWF4U2NhbGUgPSB0aGlzLnZpZXdwb3J0LnNjYWxlICogNDtcclxuXHJcbiAgICAvLyBzdGFydCBwb2ludCB0byBkcmF3IGltYWdlXHJcbiAgICB0aGlzLnZpZXdwb3J0LndpZHRoID0gdGhpcy5faW1hZ2Uud2lkdGggKiB0aGlzLnZpZXdwb3J0LnNjYWxlO1xyXG4gICAgdGhpcy52aWV3cG9ydC5oZWlnaHQgPSB0aGlzLl9pbWFnZS5oZWlnaHQgKiB0aGlzLnZpZXdwb3J0LnNjYWxlO1xyXG4gICAgdGhpcy52aWV3cG9ydC54ID0gKGNhbnZhc0RpbS53aWR0aCAtIHRoaXMudmlld3BvcnQud2lkdGgpIC8gMjtcclxuICAgIHRoaXMudmlld3BvcnQueSA9IChjYW52YXNEaW0uaGVpZ2h0IC0gdGhpcy52aWV3cG9ydC5oZWlnaHQpIC8gMjtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBkcmF3KGN0eCwgY29uZmlnOiBJbWFnZVZpZXdlckNvbmZpZywgY2FudmFzRGltOiBEaW1lbnNpb24sIG9uRmluaXNoKSB7XHJcbiAgICAvLyBjbGVhciBjYW52YXNcclxuICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgY2FudmFzRGltLndpZHRoLCBjYW52YXNEaW0uaGVpZ2h0KTtcclxuXHJcbiAgICAvLyBEcmF3IGJhY2tncm91bmQgY29sb3I7XHJcbiAgICBjdHguZmlsbFN0eWxlID0gY29uZmlnLmJnU3R5bGU7XHJcbiAgICBjdHguZmlsbFJlY3QoMCwgMCwgY2FudmFzRGltLndpZHRoLCBjYW52YXNEaW0uaGVpZ2h0KTtcclxuXHJcbiAgICAvLyBkcmF3IGltYWdlICh0cmFuc2Zvcm1lZCwgcm90YXRlIGFuZCBzY2FsZWQpXHJcbiAgICBpZiAoIXRoaXMubG9hZGluZyAmJiB0aGlzLmxvYWRlZCkge1xyXG4gICAgICBjdHgudHJhbnNsYXRlKHRoaXMudmlld3BvcnQueCArIHRoaXMudmlld3BvcnQud2lkdGggLyAyLCB0aGlzLnZpZXdwb3J0LnkgKyB0aGlzLnZpZXdwb3J0LmhlaWdodCAvIDIpO1xyXG4gICAgICBjdHgucm90YXRlKHRoaXMudmlld3BvcnQucm90YXRpb24gKiBNYXRoLlBJIC8gMTgwKTtcclxuICAgICAgY3R4LnNjYWxlKHRoaXMudmlld3BvcnQuc2NhbGUsIHRoaXMudmlld3BvcnQuc2NhbGUpO1xyXG4gICAgICBjdHguZHJhd0ltYWdlKHRoaXMuX2ltYWdlLCAtdGhpcy5faW1hZ2Uud2lkdGggLyAyLCAtdGhpcy5faW1hZ2UuaGVpZ2h0IC8gMik7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBjdHguZmlsbFN0eWxlID0gJyMzMzMnO1xyXG4gICAgICBjdHguZm9udCA9ICcyNXB4IFZlcmRhbmEnO1xyXG4gICAgICBjdHgudGV4dEFsaWduID0gJ2NlbnRlcic7XHJcbiAgICAgIGN0eC5maWxsVGV4dChjb25maWcubG9hZGluZ01lc3NhZ2UgfHwgJ0xvYWRpbmcuLi4nLCBjYW52YXNEaW0ud2lkdGggLyAyLCBjYW52YXNEaW0uaGVpZ2h0IC8gMik7XHJcbiAgICB9XHJcblxyXG4gICAgb25GaW5pc2goY3R4LCBjb25maWcsIGNhbnZhc0RpbSk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgb25SZXNvdXJjZUNoYW5nZSgpIHsgcmV0dXJuIHRoaXMucmVzb3VyY2VDaGFuZ2UuYXNPYnNlcnZhYmxlKCk7IH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHRvU3F1YXJlQW5nbGUoYW5nbGU6IG51bWJlcikge1xyXG4gIHJldHVybiA5MCAqICgoTWF0aC50cnVuYyhhbmdsZSAvIDkwKSArIChNYXRoLnRydW5jKGFuZ2xlICUgOTApID4gNDUgPyAxIDogMCkpICUgNCk7XHJcbn1cclxuIl19