/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
import { Component, Input, ViewChild, Renderer2, Inject } from '@angular/core';
import { DomSanitizer } from '@angular/platform-browser';
import { ImageViewerConfig, IMAGEVIEWER_CONFIG, IMAGEVIEWER_CONFIG_DEFAULT } from './imageviewer.config';
import { Button, toSquareAngle } from './imageviewer.model';
import { ImageResourceLoader } from './image.loader';
import { ImageCacheService } from './imagecache.service';
import { PdfResourceLoader } from './pdf.loader';
var /** @type {?} */ MIN_TOOLTIP_WIDTH_SPACE = 500;
var ImageViewerComponent = /** @class */ (function () {
    //#endregion
    //#region Lifecycle events
    function ImageViewerComponent(_sanitizer, _renderer, _imageCache, config) {
        this._sanitizer = _sanitizer;
        this._renderer = _renderer;
        this._imageCache = _imageCache;
        this.config = config;
        this._dirty = true;
        this._buttons = [];
        this._currentTooltip = null;
        this._touchStartState = {};
        this._listenDestroyList = [];
        this.config = this.extendsDefaultConfig(config);
        this._nextPageButton = new Button(this.config.nextPageButton, this.config.buttonStyle);
        this._beforePageButton = new Button(this.config.beforePageButton, this.config.buttonStyle);
        this._zoomOutButton = new Button(this.config.zoomOutButton, this.config.buttonStyle);
        this._zoomInButton = new Button(this.config.zoomInButton, this.config.buttonStyle);
        this._rotateLeftButton = new Button(this.config.rotateLeftButton, this.config.buttonStyle);
        this._rotateRightButton = new Button(this.config.rotateRightButton, this.config.buttonStyle);
        this._resetButton = new Button(this.config.resetButton, this.config.buttonStyle);
        this._buttons = [
            this._zoomOutButton,
            this._zoomInButton,
            this._rotateLeftButton,
            this._rotateRightButton,
            this._resetButton
        ].filter(function (item) { return item.display; })
            .sort(function (a, b) { return a.sortId - b.sortId; });
    }
    Object.defineProperty(ImageViewerComponent.prototype, "src", {
        get: /**
         * @return {?}
         */
        function () { return this._src; },
        set: /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            if (value === this._src) {
                return;
            }
            this._src = value;
            this.setUpResource();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ImageViewerComponent.prototype, "filetype", {
        get: /**
         * @return {?}
         */
        function () { return this._filetype; },
        set: /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            if (value === this._filetype) {
                return;
            }
            this._filetype = value;
            this.setUpResource();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ImageViewerComponent.prototype, "width", {
        get: /**
         * @return {?}
         */
        function () { return this._width; },
        set: /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            if (value === this._width) {
                return;
            }
            this._width = value;
            if (this._canvas) {
                this._canvas.width = this._width;
            }
            this.resetImage();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ImageViewerComponent.prototype, "height", {
        get: /**
         * @return {?}
         */
        function () { return this._height; },
        set: /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            if (value === this._height) {
                return;
            }
            this._height = value;
            if (this._canvas) {
                this._canvas.height = this._height;
            }
            this.resetImage();
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    ImageViewerComponent.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this._canvas = this.canvasRef.nativeElement;
        this._context = this._canvas.getContext('2d');
        // setting canvas dimention
        this._canvas.width = this.width || this.config.width;
        this._canvas.height = this.height || this.config.height;
        // setting buttons actions
        this._nextPageButton.onClick = function (evt) { _this.nextPage(); return false; };
        this._beforePageButton.onClick = function (evt) { _this.previousPage(); return false; };
        this._zoomOutButton.onClick = function (evt) { _this.zoomOut(); return false; };
        this._zoomInButton.onClick = function (evt) { _this.zoomIn(); return false; };
        this._rotateLeftButton.onClick = function (evt) { _this.rotateLeft(); return false; };
        this._rotateRightButton.onClick = function (evt) { _this.rotateRight(); return false; };
        this._resetButton.onClick = function (evt) { _this.resetImage(); return false; };
        // register event listeners
        this.addEventListeners();
        this.updateCanvas();
    };
    /**
     * @return {?}
     */
    ImageViewerComponent.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        // unregiste event listeners
        this._listenDestroyList.forEach(function (listenDestroy) {
            if (typeof listenDestroy === 'function') {
                listenDestroy();
            }
        });
        this._imageCache.disposeCache();
    };
    /**
     * @return {?}
     */
    ImageViewerComponent.prototype.setUpResource = /**
     * @return {?}
     */
    function () {
        var _this = this;
        if (this.isImage(this.src) && (!this._resource || !(this._resource instanceof ImageResourceLoader))) {
            if (this._resourceChangeSub) {
                this._resourceChangeSub.unsubscribe();
            }
            if (!this._imageResource) {
                this._imageResource = new ImageResourceLoader();
            }
            this._resource = this._imageResource;
        }
        else if (this.isPdf(this.src) && (!this._resource || !(this._resource instanceof PdfResourceLoader))) {
            if (this._resourceChangeSub) {
                this._resourceChangeSub.unsubscribe();
            }
            if (!this._pdfResource) {
                this._pdfResource = new PdfResourceLoader(this._imageCache);
            }
            this._resource = this._pdfResource;
        }
        if (this._resource) {
            this._resource.src = this.src instanceof File ? URL.createObjectURL(this.src) : this.src;
            this._resourceChangeSub = this._resource.onResourceChange().subscribe(function () {
                _this.updateCanvas();
                if (_this.src instanceof File) {
                    URL.revokeObjectURL(_this._resource.src);
                }
            });
            this._resource.setUp();
            this.resetImage();
            if (this._context) {
                this.updateCanvas();
            }
        }
    };
    //#endregion
    //#region Touch events
    /**
     * @param {?} evt
     * @return {?}
     */
    ImageViewerComponent.prototype.onTap = /**
     * @param {?} evt
     * @return {?}
     */
    function (evt) {
        var /** @type {?} */ activeElement = this.getUIElement(this.screenToCanvasCentre(evt.center));
        if (activeElement !== null) {
            activeElement.onClick(evt);
        }
    };
    /**
     * @return {?}
     */
    ImageViewerComponent.prototype.onTouchEnd = /**
     * @return {?}
     */
    function () {
        this._touchStartState.viewport = undefined;
        this._touchStartState.scale = undefined;
        this._touchStartState.rotate = undefined;
    };
    /**
     * @param {?} evt
     * @return {?}
     */
    ImageViewerComponent.prototype.processTouchEvent = /**
     * @param {?} evt
     * @return {?}
     */
    function (evt) {
        // process pan
        if (!this._touchStartState.viewport) {
            this._touchStartState.viewport = Object.assign({}, this._resource.viewport);
        }
        var /** @type {?} */ viewport = this._resource.viewport;
        viewport.x = this._touchStartState.viewport.x + evt.deltaX;
        viewport.y = this._touchStartState.viewport.y + evt.deltaY;
        // process pinch in/out
        if (!this._touchStartState.scale) {
            this._touchStartState.scale = this._resource.viewport.scale;
        }
        var /** @type {?} */ newScale = this._touchStartState.scale * evt.scale;
        viewport.scale = newScale > this._resource.maxScale ? this._resource.maxScale :
            newScale < this._resource.minScale ? this._resource.minScale : newScale;
        // process rotate left/right
        if (!this._touchStartState.rotate) {
            this._touchStartState.rotate = { rotation: viewport.rotation, startRotate: evt.rotation };
        }
        if (evt.rotation !== 0) {
            var /** @type {?} */ newAngle = this._touchStartState.rotate.rotation + evt.rotation - this._touchStartState.rotate.startRotate;
            viewport.rotation = this.config.rotateStepper ? toSquareAngle(newAngle) : newAngle;
        }
        this._dirty = true;
    };
    /**
     * @return {?}
     */
    ImageViewerComponent.prototype.addEventListeners = /**
     * @return {?}
     */
    function () {
        var _this = this;
        // zooming
        this._listenDestroyList.push(this._renderer.listen(this._canvas, 'DOMMouseScroll', function (evt) { return _this.onMouseWheel(evt); }));
        this._listenDestroyList.push(this._renderer.listen(this._canvas, 'mousewheel', function (evt) { return _this.onMouseWheel(evt); }));
        // show tooltip when mouseover it
        this._listenDestroyList.push(this._renderer.listen(this._canvas, 'mousemove', function (evt) {
            return _this.checkTooltipActivation(_this.screenToCanvasCentre({ x: evt.clientX, y: evt.clientY }));
        }));
    };
    /**
     * @param {?} evt
     * @return {?}
     */
    ImageViewerComponent.prototype.onMouseWheel = /**
     * @param {?} evt
     * @return {?}
     */
    function (evt) {
        if (!evt) {
            evt = event;
        }
        evt.preventDefault();
        if (evt.detail < 0 || evt.wheelDelta > 0) {
            // up -> larger
            this.zoomIn();
        }
        else {
            // down -> smaller
            this.zoomOut();
        }
    };
    /**
     * @param {?} pos
     * @return {?}
     */
    ImageViewerComponent.prototype.checkTooltipActivation = /**
     * @param {?} pos
     * @return {?}
     */
    function (pos) {
        this.getUIElements().forEach(function (x) { return x.hover = false; });
        var /** @type {?} */ activeElement = this.getUIElement(pos);
        var /** @type {?} */ oldToolTip = this._currentTooltip;
        if (activeElement !== null) {
            if (typeof activeElement.hover !== 'undefined') {
                activeElement.hover = true;
            }
            if (typeof activeElement.tooltip !== 'undefined') {
                this._currentTooltip = activeElement.tooltip;
            }
        }
        if (oldToolTip !== this._currentTooltip) {
            this._dirty = true;
        }
    };
    /**
     * @return {?}
     */
    ImageViewerComponent.prototype.nextPage = /**
     * @return {?}
     */
    function () {
        if (!this._resource) {
            return;
        }
        if (this._resource.currentItem >= this._resource.totalItem) {
            return;
        }
        if (this._resource.currentItem < 1) {
            this._resource.currentItem = 0;
        }
        this._resource.currentItem++;
        this._resource.loadResource();
        this._dirty = true;
    };
    /**
     * @return {?}
     */
    ImageViewerComponent.prototype.previousPage = /**
     * @return {?}
     */
    function () {
        if (!this._resource) {
            return;
        }
        if (this._resource.currentItem <= 1) {
            return;
        }
        if (this._resource.currentItem > this._resource.totalItem) {
            this._resource.currentItem = this._resource.totalItem + 1;
        }
        this._resource.currentItem--;
        this._resource.loadResource();
        this._dirty = true;
    };
    /**
     * @return {?}
     */
    ImageViewerComponent.prototype.zoomIn = /**
     * @return {?}
     */
    function () {
        if (!this._resource) {
            return;
        }
        var /** @type {?} */ newScale = this._resource.viewport.scale * (1 + this.config.scaleStep);
        this._resource.viewport.scale = newScale > this._resource.maxScale ? this._resource.maxScale : newScale;
        this._dirty = true;
    };
    /**
     * @return {?}
     */
    ImageViewerComponent.prototype.zoomOut = /**
     * @return {?}
     */
    function () {
        if (!this._resource) {
            return;
        }
        var /** @type {?} */ newScale = this._resource.viewport.scale * (1 - this.config.scaleStep);
        this._resource.viewport.scale = newScale < this._resource.minScale ? this._resource.minScale : newScale;
        this._dirty = true;
    };
    /**
     * @return {?}
     */
    ImageViewerComponent.prototype.rotateLeft = /**
     * @return {?}
     */
    function () {
        if (!this._resource) {
            return;
        }
        var /** @type {?} */ viewport = this._resource.viewport;
        viewport.rotation = viewport.rotation === 0 ? 270 : viewport.rotation - 90;
        this._dirty = true;
    };
    /**
     * @return {?}
     */
    ImageViewerComponent.prototype.rotateRight = /**
     * @return {?}
     */
    function () {
        if (!this._resource) {
            return;
        }
        var /** @type {?} */ viewport = this._resource.viewport;
        viewport.rotation = viewport.rotation === 270 ? 0 : viewport.rotation + 90;
        this._dirty = true;
    };
    /**
     * @return {?}
     */
    ImageViewerComponent.prototype.resetImage = /**
     * @return {?}
     */
    function () {
        if (!this._resource) {
            return;
        }
        this._resource.resetViewport(this._canvas);
        this._dirty = true;
    };
    /**
     * @return {?}
     */
    ImageViewerComponent.prototype.updateCanvas = /**
     * @return {?}
     */
    function () {
        this.resetImage();
        // start new render loop
        this.render();
    };
    /**
     * @return {?}
     */
    ImageViewerComponent.prototype.render = /**
     * @return {?}
     */
    function () {
        var _this = this;
        var /** @type {?} */ vm = this;
        // only re-render if dirty
        if (this._dirty && this._resource) {
            this._dirty = false;
            var /** @type {?} */ ctx_1 = this._context;
            ctx_1.save();
            this._resource.draw(ctx_1, this.config, this._canvas, function () {
                ctx_1.restore();
                if (vm._resource.loaded) {
                    // draw buttons
                    // draw buttons
                    _this.drawButtons(ctx_1);
                    // draw paginator
                    if (_this._resource.showItemsQuantity) {
                        _this.drawPaginator(ctx_1);
                    }
                }
            });
        }
        requestAnimationFrame(function () { return _this.render(); });
    };
    /**
     * @param {?} ctx
     * @return {?}
     */
    ImageViewerComponent.prototype.drawButtons = /**
     * @param {?} ctx
     * @return {?}
     */
    function (ctx) {
        var /** @type {?} */ padding = this.config.tooltips.padding;
        var /** @type {?} */ radius = this.config.tooltips.radius;
        var /** @type {?} */ gap = 2 * radius + padding;
        var /** @type {?} */ x = this._canvas.width - radius - padding;
        var /** @type {?} */ y = this._canvas.height - radius - padding;
        // draw buttons
        for (var /** @type {?} */ i = 0; i < this._buttons.length; i++) {
            this._buttons[i].draw(ctx, x, y - gap * i, radius);
        }
        // draw tooltip
        if (this._currentTooltip !== null && this._canvas.width > MIN_TOOLTIP_WIDTH_SPACE) {
            ctx.save();
            var /** @type {?} */ fontSize = radius;
            ctx.font = fontSize + 'px sans-serif';
            // calculate position
            var /** @type {?} */ textSize = ctx.measureText(this._currentTooltip).width, /** @type {?} */ rectWidth = textSize + padding, /** @type {?} */ rectHeight = fontSize * 0.70 + padding, /** @type {?} */ rectX = this._canvas.width
                - (2 * radius + 2 * padding) // buttons
                - rectWidth, /** @type {?} */ rectY = this._canvas.height - rectHeight - padding, /** @type {?} */ textX = rectX + 0.5 * padding, /** @type {?} */ textY = this._canvas.height - 1.5 * padding;
            ctx.globalAlpha = this.config.tooltips.bgAlpha;
            ctx.fillStyle = this.config.tooltips.bgStyle;
            this.drawRoundRectangle(ctx, rectX, rectY, rectWidth, rectHeight, 8, true, false);
            ctx.globalAlpha = this.config.tooltips.textAlpha;
            ctx.fillStyle = this.config.tooltips.textStyle;
            ctx.fillText(this._currentTooltip, textX, textY);
            ctx.restore();
        }
    };
    /**
     * @param {?} ctx
     * @return {?}
     */
    ImageViewerComponent.prototype.drawPaginator = /**
     * @param {?} ctx
     * @return {?}
     */
    function (ctx) {
        var /** @type {?} */ padding = this.config.tooltips.padding;
        var /** @type {?} */ radius = this.config.tooltips.radius;
        var /** @type {?} */ labelWidth = 50;
        var /** @type {?} */ x1 = (this._canvas.width - labelWidth) / 2 - radius - padding; // PrevPageButton
        var /** @type {?} */ x2 = this._canvas.width / 2; // Label
        var /** @type {?} */ x3 = (this._canvas.width + labelWidth) / 2 + radius + padding; // NextPageButton
        var /** @type {?} */ y = this._canvas.height - radius - padding;
        var /** @type {?} */ label = this._resource.currentItem + '/' + this._resource.totalItem;
        var /** @type {?} */ fontSize = 25;
        ctx.save();
        this._beforePageButton.draw(ctx, x1, y, radius);
        this._nextPageButton.draw(ctx, x3, y, radius);
        ctx.restore();
        ctx.save();
        ctx.font = fontSize + 'px Verdana';
        ctx.textAlign = 'center';
        ctx.fillText(label, x2, this._canvas.height - padding - fontSize / 2, labelWidth);
        ctx.restore();
    };
    /**
     * @param {?} ctx
     * @param {?} x
     * @param {?} y
     * @param {?} width
     * @param {?} height
     * @param {?} radius
     * @param {?} fill
     * @param {?} stroke
     * @return {?}
     */
    ImageViewerComponent.prototype.drawRoundRectangle = /**
     * @param {?} ctx
     * @param {?} x
     * @param {?} y
     * @param {?} width
     * @param {?} height
     * @param {?} radius
     * @param {?} fill
     * @param {?} stroke
     * @return {?}
     */
    function (ctx, x, y, width, height, radius, fill, stroke) {
        radius = (typeof radius === 'number') ? radius : 5;
        fill = (typeof fill === 'boolean') ? fill : true; // fill = default
        stroke = (typeof stroke === 'boolean') ? stroke : false;
        // draw round rectangle
        ctx.beginPath();
        ctx.moveTo(x + radius, y);
        ctx.lineTo(x + width - radius, y);
        ctx.quadraticCurveTo(x + width, y, x + width, y + radius);
        ctx.lineTo(x + width, y + height - radius);
        ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);
        ctx.lineTo(x + radius, y + height);
        ctx.quadraticCurveTo(x, y + height, x, y + height - radius);
        ctx.lineTo(x, y + radius);
        ctx.quadraticCurveTo(x, y, x + radius, y);
        ctx.closePath();
        if (fill) {
            ctx.fill();
        }
        if (stroke) {
            ctx.stroke();
        }
    };
    /**
     * @param {?} cfg
     * @return {?}
     */
    ImageViewerComponent.prototype.extendsDefaultConfig = /**
     * @param {?} cfg
     * @return {?}
     */
    function (cfg) {
        var /** @type {?} */ defaultCfg = IMAGEVIEWER_CONFIG_DEFAULT;
        var /** @type {?} */ localCfg = Object.assign({}, defaultCfg, cfg);
        if (cfg.buttonStyle) {
            localCfg.buttonStyle = Object.assign(defaultCfg.buttonStyle, cfg.buttonStyle);
        }
        if (cfg.tooltips) {
            localCfg.tooltips = Object.assign(defaultCfg.tooltips, cfg.tooltips);
        }
        if (cfg.nextPageButton) {
            localCfg.nextPageButton = Object.assign(defaultCfg.nextPageButton, cfg.nextPageButton);
        }
        if (cfg.beforePageButton) {
            localCfg.beforePageButton = Object.assign(defaultCfg.beforePageButton, cfg.beforePageButton);
        }
        if (cfg.zoomOutButton) {
            localCfg.zoomOutButton = Object.assign(defaultCfg.zoomOutButton, cfg.zoomOutButton);
        }
        if (cfg.zoomOutButton) {
            localCfg.zoomOutButton = Object.assign(defaultCfg.zoomOutButton, cfg.zoomOutButton);
        }
        if (cfg.zoomInButton) {
            localCfg.zoomInButton = Object.assign(defaultCfg.zoomInButton, cfg.zoomInButton);
        }
        if (cfg.rotateLeftButton) {
            localCfg.rotateLeftButton = Object.assign(defaultCfg.rotateLeftButton, cfg.rotateLeftButton);
        }
        if (cfg.rotateRightButton) {
            localCfg.rotateRightButton = Object.assign(defaultCfg.rotateRightButton, cfg.rotateRightButton);
        }
        if (cfg.resetButton) {
            localCfg.resetButton = Object.assign(defaultCfg.resetButton, cfg.resetButton);
        }
        return localCfg;
    };
    /**
     * @param {?} pos
     * @return {?}
     */
    ImageViewerComponent.prototype.screenToCanvasCentre = /**
     * @param {?} pos
     * @return {?}
     */
    function (pos) {
        var /** @type {?} */ rect = this._canvas.getBoundingClientRect();
        return { x: pos.x - rect.left, y: pos.y - rect.top };
    };
    /**
     * @return {?}
     */
    ImageViewerComponent.prototype.getUIElements = /**
     * @return {?}
     */
    function () {
        var /** @type {?} */ hoverElements = this._buttons.slice();
        hoverElements.push(this._nextPageButton);
        hoverElements.push(this._beforePageButton);
        return hoverElements;
    };
    /**
     * @param {?} pos
     * @return {?}
     */
    ImageViewerComponent.prototype.getUIElement = /**
     * @param {?} pos
     * @return {?}
     */
    function (pos) {
        var /** @type {?} */ activeUIElement = this.getUIElements().filter(function (uiElement) {
            return uiElement.isWithinBounds(pos.x, pos.y);
        });
        return (activeUIElement.length > 0) ? activeUIElement[0] : null;
    };
    /**
     * @param {?} file
     * @return {?}
     */
    ImageViewerComponent.prototype.isImage = /**
     * @param {?} file
     * @return {?}
     */
    function (file) {
        if (this._filetype && this._filetype.toLowerCase() === 'image') {
            return true;
        }
        return testFile(file, '\\.(png|jpg|jpeg|gif)|image/png');
    };
    /**
     * @param {?} file
     * @return {?}
     */
    ImageViewerComponent.prototype.isPdf = /**
     * @param {?} file
     * @return {?}
     */
    function (file) {
        if (this._filetype && this._filetype.toLowerCase() === 'pdf') {
            return true;
        }
        return testFile(file, '\\.(pdf)|application/pdf');
    };
    ImageViewerComponent.decorators = [
        { type: Component, args: [{
                    selector: 'ngx-imageviewer',
                    template: "\n    <canvas #imageContainer [width]=\"width\" [height]=\"height\"\n      (tap)=\"onTap($event)\" (pinchin)=\"processTouchEvent($event)\" (pinchout)=\"processTouchEvent($event)\"\n      (panmove)=\"processTouchEvent($event)\" (panend)=\"onTouchEnd()\" (rotatemove)=\"processTouchEvent($event)\"\n        (rotateend)=\"onTouchEnd()\">\n    </canvas>\n  ",
                    styles: ["\n    :host { display: block }\n    :host canvas { margin: 0 auto; display: block }\n    [hidden] { display: none !important }\n  "]
                },] },
    ];
    //#endregion
    /** @nocollapse */
    ImageViewerComponent.ctorParameters = function () { return [
        { type: DomSanitizer, },
        { type: Renderer2, },
        { type: ImageCacheService, },
        { type: ImageViewerConfig, decorators: [{ type: Inject, args: [IMAGEVIEWER_CONFIG,] },] },
    ]; };
    ImageViewerComponent.propDecorators = {
        "src": [{ type: Input, args: ['src',] },],
        "filetype": [{ type: Input, args: ['filetype',] },],
        "width": [{ type: Input, args: ['width',] },],
        "height": [{ type: Input, args: ['height',] },],
        "canvasRef": [{ type: ViewChild, args: ['imageContainer',] },],
    };
    return ImageViewerComponent;
}());
export { ImageViewerComponent };
function ImageViewerComponent_tsickle_Closure_declarations() {
    /** @type {!Array<{type: !Function, args: (undefined|!Array<?>)}>} */
    ImageViewerComponent.decorators;
    /**
     * @nocollapse
     * @type {function(): !Array<(null|{type: ?, decorators: (undefined|!Array<{type: !Function, args: (undefined|!Array<?>)}>)})>}
     */
    ImageViewerComponent.ctorParameters;
    /** @type {!Object<string,!Array<{type: !Function, args: (undefined|!Array<?>)}>>} */
    ImageViewerComponent.propDecorators;
    /** @type {?} */
    ImageViewerComponent.prototype._src;
    /** @type {?} */
    ImageViewerComponent.prototype._filetype;
    /** @type {?} */
    ImageViewerComponent.prototype._width;
    /** @type {?} */
    ImageViewerComponent.prototype._height;
    /** @type {?} */
    ImageViewerComponent.prototype.canvasRef;
    /** @type {?} */
    ImageViewerComponent.prototype._canvas;
    /** @type {?} */
    ImageViewerComponent.prototype._context;
    /** @type {?} */
    ImageViewerComponent.prototype._dirty;
    /** @type {?} */
    ImageViewerComponent.prototype._nextPageButton;
    /** @type {?} */
    ImageViewerComponent.prototype._beforePageButton;
    /** @type {?} */
    ImageViewerComponent.prototype._zoomOutButton;
    /** @type {?} */
    ImageViewerComponent.prototype._zoomInButton;
    /** @type {?} */
    ImageViewerComponent.prototype._rotateLeftButton;
    /** @type {?} */
    ImageViewerComponent.prototype._rotateRightButton;
    /** @type {?} */
    ImageViewerComponent.prototype._resetButton;
    /** @type {?} */
    ImageViewerComponent.prototype._buttons;
    /** @type {?} */
    ImageViewerComponent.prototype._currentTooltip;
    /** @type {?} */
    ImageViewerComponent.prototype._touchStartState;
    /** @type {?} */
    ImageViewerComponent.prototype._listenDestroyList;
    /** @type {?} */
    ImageViewerComponent.prototype._resource;
    /** @type {?} */
    ImageViewerComponent.prototype._resourceChangeSub;
    /** @type {?} */
    ImageViewerComponent.prototype._imageResource;
    /** @type {?} */
    ImageViewerComponent.prototype._pdfResource;
    /** @type {?} */
    ImageViewerComponent.prototype._sanitizer;
    /** @type {?} */
    ImageViewerComponent.prototype._renderer;
    /** @type {?} */
    ImageViewerComponent.prototype._imageCache;
    /** @type {?} */
    ImageViewerComponent.prototype.config;
}
/**
 * @param {?} file
 * @param {?} regexTest
 * @return {?}
 */
function testFile(file, regexTest) {
    if (!file) {
        return false;
    }
    var /** @type {?} */ name = file instanceof File ? file.name : file;
    return name.toLowerCase().match(regexTest) !== null;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW1hZ2V2aWV3ZXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGhhbGx5c29uaC9uZ3gtaW1hZ2V2aWV3ZXIvIiwic291cmNlcyI6WyJsaWIvaW1hZ2V2aWV3ZXIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxTQUFTLEVBQWlCLFNBQVMsRUFBRSxNQUFNLEVBQWEsTUFBTSxlQUFlLENBQUM7QUFDekcsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBR3pELE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxrQkFBa0IsRUFBRSwwQkFBMEIsRUFBNkIsTUFBTSxzQkFBc0IsQ0FBQztBQUNwSSxPQUFPLEVBQVksTUFBTSxFQUFFLGFBQWEsRUFBa0IsTUFBTSxxQkFBcUIsQ0FBQztBQUN0RixPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUNyRCxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUN6RCxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxjQUFjLENBQUM7QUFFakQscUJBQU0sdUJBQXVCLEdBQUcsR0FBRyxDQUFDOztJQStGbEMsWUFBWTtJQUVaLDBCQUEwQjtJQUMxQiw4QkFDVSxZQUNBLFdBQ0EsYUFDNEI7UUFINUIsZUFBVSxHQUFWLFVBQVU7UUFDVixjQUFTLEdBQVQsU0FBUztRQUNULGdCQUFXLEdBQVgsV0FBVztRQUNpQixXQUFNLEdBQU4sTUFBTTtzQkF0QzNCLElBQUk7d0JBWUYsRUFBRTsrQkFHSyxJQUFJO2dDQUdFLEVBQUU7a0NBR0wsRUFBRTtRQW1CN0IsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsb0JBQW9CLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDaEQsSUFBSSxDQUFDLGVBQWUsR0FBRyxJQUFJLE1BQU0sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLGNB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SGpCLGlCQUFpQix1QkE0R3JCLE1BQU0sU0FBQyxrQkFBa0I7Ozt3QkFoRjNCLEtBQUssU0FBQyxLQUFLOzZCQVNYLEtBQUssU0FBQyxVQUFVOzBCQVFoQixLQUFLLFNBQUMsT0FBTzsyQkFTYixLQUFLLFNBQUMsUUFBUTs4QkFPZCxTQUFTLFNBQUMsZ0JBQWdCOzsrQkFqRTdCOztTQTJCYSxvQkFBb0I7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBdWRqQyxrQkFBa0IsSUFBbUIsRUFBRSxTQUFpQjtJQUN0RCxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7UUFBQyxNQUFNLENBQUMsS0FBSyxDQUFDO0tBQUU7SUFDNUIscUJBQU0sSUFBSSxHQUFHLElBQUksWUFBWSxJQUFJLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQztJQUNyRCxNQUFNLENBQUMsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDLEtBQUssQ0FBQyxTQUFTLENBQUMsS0FBSyxJQUFJLENBQUM7Q0FDckQiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIElucHV0LCBWaWV3Q2hpbGQsIEFmdGVyVmlld0luaXQsIFJlbmRlcmVyMiwgSW5qZWN0LCBPbkRlc3Ryb3kgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgRG9tU2FuaXRpemVyIH0gZnJvbSAnQGFuZ3VsYXIvcGxhdGZvcm0tYnJvd3Nlcic7XHJcbmltcG9ydCB7IFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnO1xyXG5cclxuaW1wb3J0IHsgSW1hZ2VWaWV3ZXJDb25maWcsIElNQUdFVklFV0VSX0NPTkZJRywgSU1BR0VWSUVXRVJfQ09ORklHX0RFRkFVTFQsIEJ1dHRvbkNvbmZpZywgQnV0dG9uU3R5bGUgfSBmcm9tICcuL2ltYWdldmlld2VyLmNvbmZpZyc7XHJcbmltcG9ydCB7IFZpZXdwb3J0LCBCdXR0b24sIHRvU3F1YXJlQW5nbGUsIFJlc291cmNlTG9hZGVyIH0gZnJvbSAnLi9pbWFnZXZpZXdlci5tb2RlbCc7XHJcbmltcG9ydCB7IEltYWdlUmVzb3VyY2VMb2FkZXIgfSBmcm9tICcuL2ltYWdlLmxvYWRlcic7XHJcbmltcG9ydCB7IEltYWdlQ2FjaGVTZXJ2aWNlIH0gZnJvbSAnLi9pbWFnZWNhY2hlLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBQZGZSZXNvdXJjZUxvYWRlciB9IGZyb20gJy4vcGRmLmxvYWRlcic7XHJcblxyXG5jb25zdCBNSU5fVE9PTFRJUF9XSURUSF9TUEFDRSA9IDUwMDtcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gIHNlbGVjdG9yOiAnbmd4LWltYWdldmlld2VyJyxcclxuICB0ZW1wbGF0ZTogYFxyXG4gICAgPGNhbnZhcyAjaW1hZ2VDb250YWluZXIgW3dpZHRoXT1cIndpZHRoXCIgW2hlaWdodF09XCJoZWlnaHRcIlxyXG4gICAgICAodGFwKT1cIm9uVGFwKCRldmVudClcIiAocGluY2hpbik9XCJwcm9jZXNzVG91Y2hFdmVudCgkZXZlbnQpXCIgKHBpbmNob3V0KT1cInByb2Nlc3NUb3VjaEV2ZW50KCRldmVudClcIlxyXG4gICAgICAocGFubW92ZSk9XCJwcm9jZXNzVG91Y2hFdmVudCgkZXZlbnQpXCIgKHBhbmVuZCk9XCJvblRvdWNoRW5kKClcIiAocm90YXRlbW92ZSk9XCJwcm9jZXNzVG91Y2hFdmVudCgkZXZlbnQpXCJcclxuICAgICAgICAocm90YXRlZW5kKT1cIm9uVG91Y2hFbmQoKVwiPlxyXG4gICAgPC9jYW52YXM+XHJcbiAgYCxcclxuICBzdHlsZXM6IFtgXHJcbiAgICA6aG9zdCB7IGRpc3BsYXk6IGJsb2NrIH1cclxuICAgIDpob3N0IGNhbnZhcyB7IG1hcmdpbjogMCBhdXRvOyBkaXNwbGF5OiBibG9jayB9XHJcbiAgICBbaGlkZGVuXSB7IGRpc3BsYXk6IG5vbmUgIWltcG9ydGFudCB9XHJcbiAgYF1cclxufSlcclxuZXhwb3J0IGNsYXNzIEltYWdlVmlld2VyQ29tcG9uZW50IGltcGxlbWVudHMgQWZ0ZXJWaWV3SW5pdCwgT25EZXN0cm95IHtcclxuXHJcbiAgLy8jcmVnaW9uIElucHV0IHByb3BlcnRpZXNcclxuICBwcml2YXRlIF9zcmM6IHN0cmluZyB8IEZpbGU7XHJcbiAgZ2V0IHNyYygpIHsgcmV0dXJuIHRoaXMuX3NyYzsgfVxyXG4gIEBJbnB1dCgnc3JjJykgc2V0IHNyYyh2YWx1ZSkge1xyXG4gICAgaWYgKHZhbHVlID09PSB0aGlzLl9zcmMpIHsgcmV0dXJuOyB9XHJcbiAgICB0aGlzLl9zcmMgPSB2YWx1ZTtcclxuICAgIHRoaXMuc2V0VXBSZXNvdXJjZSgpO1xyXG4gIH1cclxuXHJcbiAgLy8gRklYIG5vdCB3b3JraWduIHByb3Blcmx5XHJcbiAgcHJpdmF0ZSBfZmlsZXR5cGU6IHN0cmluZztcclxuICBnZXQgZmlsZXR5cGUoKSB7IHJldHVybiB0aGlzLl9maWxldHlwZTsgfVxyXG4gIEBJbnB1dCgnZmlsZXR5cGUnKSBzZXQgZmlsZXR5cGUodmFsdWU6IHN0cmluZykge1xyXG4gICAgaWYgKHZhbHVlID09PSB0aGlzLl9maWxldHlwZSkgeyByZXR1cm47IH1cclxuICAgIHRoaXMuX2ZpbGV0eXBlID0gdmFsdWU7XHJcbiAgICB0aGlzLnNldFVwUmVzb3VyY2UoKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgX3dpZHRoOiBudW1iZXI7XHJcbiAgZ2V0IHdpZHRoKCkgeyByZXR1cm4gdGhpcy5fd2lkdGg7IH1cclxuICBASW5wdXQoJ3dpZHRoJykgc2V0IHdpZHRoKHZhbHVlKSB7XHJcbiAgICBpZiAodmFsdWUgPT09IHRoaXMuX3dpZHRoKSB7IHJldHVybjsgfVxyXG4gICAgdGhpcy5fd2lkdGggPSB2YWx1ZTtcclxuICAgIGlmICh0aGlzLl9jYW52YXMpIHsgdGhpcy5fY2FudmFzLndpZHRoID0gdGhpcy5fd2lkdGg7IH1cclxuICAgIHRoaXMucmVzZXRJbWFnZSgpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBfaGVpZ2h0OiBudW1iZXI7XHJcbiAgZ2V0IGhlaWdodCgpIHsgcmV0dXJuIHRoaXMuX2hlaWdodDsgfVxyXG4gIEBJbnB1dCgnaGVpZ2h0Jykgc2V0IGhlaWdodCh2YWx1ZSkge1xyXG4gICAgaWYgKHZhbHVlID09PSB0aGlzLl9oZWlnaHQpIHsgcmV0dXJuOyB9XHJcbiAgICB0aGlzLl9oZWlnaHQgPSB2YWx1ZTtcclxuICAgIGlmICh0aGlzLl9jYW52YXMpIHsgdGhpcy5fY2FudmFzLmhlaWdodCA9IHRoaXMuX2hlaWdodDsgfVxyXG4gICAgdGhpcy5yZXNldEltYWdlKCk7XHJcbiAgfVxyXG5cclxuICBAVmlld0NoaWxkKCdpbWFnZUNvbnRhaW5lcicpIGNhbnZhc1JlZjogYW55O1xyXG4gIC8vI2VuZHJlZ2lvblxyXG5cclxuICAvLyNyZWdpb24gUHJpdmF0ZSBwcm9wZXJ0aWVzXHJcbiAgLy8gQ2FudmFzIDJEIGNvbnRleHRcclxuICBwcml2YXRlIF9jYW52YXM6IEhUTUxDYW52YXNFbGVtZW50O1xyXG4gIHByaXZhdGUgX2NvbnRleHQ6IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRDtcclxuXHJcbiAgLy8gZGlydHkgc3RhdGVcclxuICBwcml2YXRlIF9kaXJ0eSA9IHRydWU7XHJcblxyXG4gIC8vIGFjdGlvbiBidXR0b25zXHJcbiAgcHJpdmF0ZSBfbmV4dFBhZ2VCdXR0b246IEJ1dHRvbjtcclxuICBwcml2YXRlIF9iZWZvcmVQYWdlQnV0dG9uOiBCdXR0b247XHJcbiAgcHJpdmF0ZSBfem9vbU91dEJ1dHRvbjogQnV0dG9uO1xyXG4gIHByaXZhdGUgX3pvb21JbkJ1dHRvbjogQnV0dG9uO1xyXG4gIHByaXZhdGUgX3JvdGF0ZUxlZnRCdXR0b246IEJ1dHRvbjtcclxuICBwcml2YXRlIF9yb3RhdGVSaWdodEJ1dHRvbjogQnV0dG9uO1xyXG4gIHByaXZhdGUgX3Jlc2V0QnV0dG9uOiBCdXR0b247XHJcblxyXG4gIC8vIGNvbnRhaW5zIGFsbCBhY3RpdmUgYnV0dG9uc1xyXG4gIHByaXZhdGUgX2J1dHRvbnMgPSBbXTtcclxuXHJcbiAgLy8gY3VycmVudCB0b29sIHRpcCAodXNlZCB0byB0cmFjayBjaGFuZ2Ugb2YgdG9vbCB0aXApXHJcbiAgcHJpdmF0ZSBfY3VycmVudFRvb2x0aXAgPSBudWxsO1xyXG5cclxuICAvLyBjYWNoZWQgZGF0YSB3aGVuIHRvdWNoIGV2ZW50cyBzdGFydGVkXHJcbiAgcHJpdmF0ZSBfdG91Y2hTdGFydFN0YXRlOiBhbnkgPSB7fTtcclxuXHJcbiAgLy8gbGlzdCBvZiBldmVudCBsaXN0ZW5lciBkZXN0cm95ZXJzXHJcbiAgcHJpdmF0ZSBfbGlzdGVuRGVzdHJveUxpc3QgPSBbXTtcclxuXHJcbiAgLy8gaW1hZ2UgLyBQZGYgRHJhd2FibGUgUmVzb3VyY2VcclxuICBwcml2YXRlIF9yZXNvdXJjZTogUmVzb3VyY2VMb2FkZXI7XHJcbiAgcHJpdmF0ZSBfcmVzb3VyY2VDaGFuZ2VTdWI6IFN1YnNjcmlwdGlvbjtcclxuXHJcbiAgLy8gQ2FjaGluZyByZXNvdXJjZUxvYWRlciBpbnN0YW5jZXMgdG8gcmV1c2VcclxuICBwcml2YXRlIF9pbWFnZVJlc291cmNlOiBJbWFnZVJlc291cmNlTG9hZGVyO1xyXG4gIHByaXZhdGUgX3BkZlJlc291cmNlOiBQZGZSZXNvdXJjZUxvYWRlcjtcclxuXHJcbiAgLy8jZW5kcmVnaW9uXHJcblxyXG4gIC8vI3JlZ2lvbiBMaWZlY3ljbGUgZXZlbnRzXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwcml2YXRlIF9zYW5pdGl6ZXI6IERvbVNhbml0aXplcixcclxuICAgIHByaXZhdGUgX3JlbmRlcmVyOiBSZW5kZXJlcjIsXHJcbiAgICBwcml2YXRlIF9pbWFnZUNhY2hlOiBJbWFnZUNhY2hlU2VydmljZSxcclxuICAgIEBJbmplY3QoSU1BR0VWSUVXRVJfQ09ORklHKSBwcml2YXRlIGNvbmZpZzogSW1hZ2VWaWV3ZXJDb25maWdcclxuICApIHtcclxuICAgIHRoaXMuY29uZmlnID0gdGhpcy5leHRlbmRzRGVmYXVsdENvbmZpZyhjb25maWcpO1xyXG4gICAgdGhpcy5fbmV4dFBhZ2VCdXR0b24gPSBuZXcgQnV0dG9uKHRoaXMuY29uZmlnLm5leHRQYWdlQnV0dG9uLCB0aGlzLmNvbmZpZy5idXR0b25TdHlsZSk7XHJcbiAgICB0aGlzLl9iZWZvcmVQYWdlQnV0dG9uID0gbmV3IEJ1dHRvbih0aGlzLmNvbmZpZy5iZWZvcmVQYWdlQnV0dG9uLCB0aGlzLmNvbmZpZy5idXR0b25TdHlsZSk7XHJcbiAgICB0aGlzLl96b29tT3V0QnV0dG9uID0gbmV3IEJ1dHRvbih0aGlzLmNvbmZpZy56b29tT3V0QnV0dG9uLCB0aGlzLmNvbmZpZy5idXR0b25TdHlsZSk7XHJcbiAgICB0aGlzLl96b29tSW5CdXR0b24gPSBuZXcgQnV0dG9uKHRoaXMuY29uZmlnLnpvb21JbkJ1dHRvbiwgdGhpcy5jb25maWcuYnV0dG9uU3R5bGUpO1xyXG4gICAgdGhpcy5fcm90YXRlTGVmdEJ1dHRvbiA9IG5ldyBCdXR0b24odGhpcy5jb25maWcucm90YXRlTGVmdEJ1dHRvbiwgdGhpcy5jb25maWcuYnV0dG9uU3R5bGUpO1xyXG4gICAgdGhpcy5fcm90YXRlUmlnaHRCdXR0b24gPSBuZXcgQnV0dG9uKHRoaXMuY29uZmlnLnJvdGF0ZVJpZ2h0QnV0dG9uLCB0aGlzLmNvbmZpZy5idXR0b25TdHlsZSk7XHJcbiAgICB0aGlzLl9yZXNldEJ1dHRvbiA9IG5ldyBCdXR0b24odGhpcy5jb25maWcucmVzZXRCdXR0b24sIHRoaXMuY29uZmlnLmJ1dHRvblN0eWxlKTtcclxuICAgIHRoaXMuX2J1dHRvbnMgPSBbXHJcbiAgICAgIHRoaXMuX3pvb21PdXRCdXR0b24sXHJcbiAgICAgIHRoaXMuX3pvb21JbkJ1dHRvbixcclxuICAgICAgdGhpcy5fcm90YXRlTGVmdEJ1dHRvbixcclxuICAgICAgdGhpcy5fcm90YXRlUmlnaHRCdXR0b24sXHJcbiAgICAgIHRoaXMuX3Jlc2V0QnV0dG9uXHJcbiAgICBdLmZpbHRlcihpdGVtID0+IGl0ZW0uZGlzcGxheSlcclxuICAgICAgLnNvcnQoKGEsIGIpID0+IGEuc29ydElkIC0gYi5zb3J0SWQpO1xyXG4gIH1cclxuXHJcbiAgbmdBZnRlclZpZXdJbml0KCkge1xyXG4gICAgdGhpcy5fY2FudmFzID0gdGhpcy5jYW52YXNSZWYubmF0aXZlRWxlbWVudDtcclxuICAgIHRoaXMuX2NvbnRleHQgPSB0aGlzLl9jYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcclxuXHJcbiAgICAvLyBzZXR0aW5nIGNhbnZhcyBkaW1lbnRpb25cclxuICAgIHRoaXMuX2NhbnZhcy53aWR0aCA9IHRoaXMud2lkdGggfHwgdGhpcy5jb25maWcud2lkdGg7XHJcbiAgICB0aGlzLl9jYW52YXMuaGVpZ2h0ID0gdGhpcy5oZWlnaHQgfHwgdGhpcy5jb25maWcuaGVpZ2h0O1xyXG5cclxuICAgIC8vIHNldHRpbmcgYnV0dG9ucyBhY3Rpb25zXHJcbiAgICB0aGlzLl9uZXh0UGFnZUJ1dHRvbi5vbkNsaWNrID0gKGV2dCkgPT4geyB0aGlzLm5leHRQYWdlKCk7IHJldHVybiBmYWxzZTsgfTtcclxuICAgIHRoaXMuX2JlZm9yZVBhZ2VCdXR0b24ub25DbGljayA9IChldnQpID0+IHsgdGhpcy5wcmV2aW91c1BhZ2UoKTsgcmV0dXJuIGZhbHNlOyB9O1xyXG4gICAgdGhpcy5fem9vbU91dEJ1dHRvbi5vbkNsaWNrID0gKGV2dCkgPT4geyB0aGlzLnpvb21PdXQoKTsgcmV0dXJuIGZhbHNlOyB9O1xyXG4gICAgdGhpcy5fem9vbUluQnV0dG9uLm9uQ2xpY2sgPSAoZXZ0KSA9PiB7IHRoaXMuem9vbUluKCk7IHJldHVybiBmYWxzZTsgfTtcclxuICAgIHRoaXMuX3JvdGF0ZUxlZnRCdXR0b24ub25DbGljayA9IChldnQpID0+IHsgdGhpcy5yb3RhdGVMZWZ0KCk7IHJldHVybiBmYWxzZTsgfTtcclxuICAgIHRoaXMuX3JvdGF0ZVJpZ2h0QnV0dG9uLm9uQ2xpY2sgPSAoZXZ0KSA9PiB7IHRoaXMucm90YXRlUmlnaHQoKTsgcmV0dXJuIGZhbHNlOyB9O1xyXG4gICAgdGhpcy5fcmVzZXRCdXR0b24ub25DbGljayA9IChldnQpID0+IHsgdGhpcy5yZXNldEltYWdlKCk7IHJldHVybiBmYWxzZTsgfTtcclxuXHJcbiAgICAvLyByZWdpc3RlciBldmVudCBsaXN0ZW5lcnNcclxuICAgIHRoaXMuYWRkRXZlbnRMaXN0ZW5lcnMoKTtcclxuXHJcbiAgICB0aGlzLnVwZGF0ZUNhbnZhcygpO1xyXG4gIH1cclxuXHJcbiAgbmdPbkRlc3Ryb3koKSB7XHJcbiAgICAvLyB1bnJlZ2lzdGUgZXZlbnQgbGlzdGVuZXJzXHJcbiAgICB0aGlzLl9saXN0ZW5EZXN0cm95TGlzdC5mb3JFYWNoKGxpc3RlbkRlc3Ryb3kgPT4ge1xyXG4gICAgICBpZiAodHlwZW9mIGxpc3RlbkRlc3Ryb3kgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICBsaXN0ZW5EZXN0cm95KCk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgdGhpcy5faW1hZ2VDYWNoZS5kaXNwb3NlQ2FjaGUoKTtcclxuICB9XHJcblxyXG4gIHNldFVwUmVzb3VyY2UoKSB7XHJcbiAgICBpZiAodGhpcy5pc0ltYWdlKHRoaXMuc3JjKSAmJiAoIXRoaXMuX3Jlc291cmNlIHx8ICEodGhpcy5fcmVzb3VyY2UgaW5zdGFuY2VvZiBJbWFnZVJlc291cmNlTG9hZGVyKSkpIHtcclxuICAgICAgaWYgKHRoaXMuX3Jlc291cmNlQ2hhbmdlU3ViKSB7XHJcbiAgICAgICAgdGhpcy5fcmVzb3VyY2VDaGFuZ2VTdWIudW5zdWJzY3JpYmUoKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAoIXRoaXMuX2ltYWdlUmVzb3VyY2UpIHtcclxuICAgICAgICB0aGlzLl9pbWFnZVJlc291cmNlID0gbmV3IEltYWdlUmVzb3VyY2VMb2FkZXIoKTtcclxuICAgICAgfVxyXG4gICAgICB0aGlzLl9yZXNvdXJjZSA9IHRoaXMuX2ltYWdlUmVzb3VyY2U7XHJcbiAgICB9IGVsc2UgaWYgKHRoaXMuaXNQZGYodGhpcy5zcmMpICYmICghdGhpcy5fcmVzb3VyY2UgfHwgISh0aGlzLl9yZXNvdXJjZSBpbnN0YW5jZW9mIFBkZlJlc291cmNlTG9hZGVyKSkpIHtcclxuICAgICAgaWYgKHRoaXMuX3Jlc291cmNlQ2hhbmdlU3ViKSB7XHJcbiAgICAgICAgdGhpcy5fcmVzb3VyY2VDaGFuZ2VTdWIudW5zdWJzY3JpYmUoKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAoIXRoaXMuX3BkZlJlc291cmNlKSB7XHJcbiAgICAgICAgdGhpcy5fcGRmUmVzb3VyY2UgPSBuZXcgUGRmUmVzb3VyY2VMb2FkZXIodGhpcy5faW1hZ2VDYWNoZSk7XHJcbiAgICAgIH1cclxuICAgICAgdGhpcy5fcmVzb3VyY2UgPSB0aGlzLl9wZGZSZXNvdXJjZTtcclxuICAgIH1cclxuICAgIGlmICh0aGlzLl9yZXNvdXJjZSkge1xyXG4gICAgICB0aGlzLl9yZXNvdXJjZS5zcmMgPSB0aGlzLnNyYyBpbnN0YW5jZW9mIEZpbGUgPyBVUkwuY3JlYXRlT2JqZWN0VVJMKHRoaXMuc3JjKSA6IHRoaXMuc3JjO1xyXG4gICAgICB0aGlzLl9yZXNvdXJjZUNoYW5nZVN1YiA9IHRoaXMuX3Jlc291cmNlLm9uUmVzb3VyY2VDaGFuZ2UoKS5zdWJzY3JpYmUoKCkgPT4ge1xyXG4gICAgICAgIHRoaXMudXBkYXRlQ2FudmFzKCk7XHJcbiAgICAgICAgaWYgKHRoaXMuc3JjIGluc3RhbmNlb2YgRmlsZSkge1xyXG4gICAgICAgICAgVVJMLnJldm9rZU9iamVjdFVSTCh0aGlzLl9yZXNvdXJjZS5zcmMpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICAgIHRoaXMuX3Jlc291cmNlLnNldFVwKCk7XHJcbiAgICAgIHRoaXMucmVzZXRJbWFnZSgpO1xyXG4gICAgICBpZiAodGhpcy5fY29udGV4dCkgeyB0aGlzLnVwZGF0ZUNhbnZhcygpOyB9XHJcbiAgICB9XHJcbiAgfVxyXG4gIC8vI2VuZHJlZ2lvblxyXG5cclxuICAvLyNyZWdpb24gVG91Y2ggZXZlbnRzXHJcbiAgb25UYXAoZXZ0KSB7XHJcbiAgICBjb25zdCBhY3RpdmVFbGVtZW50ID0gdGhpcy5nZXRVSUVsZW1lbnQodGhpcy5zY3JlZW5Ub0NhbnZhc0NlbnRyZShldnQuY2VudGVyKSk7XHJcbiAgICBpZiAoYWN0aXZlRWxlbWVudCAhPT0gbnVsbCkgeyBhY3RpdmVFbGVtZW50Lm9uQ2xpY2soZXZ0KTsgfVxyXG4gIH1cclxuXHJcbiAgb25Ub3VjaEVuZCgpIHtcclxuICAgIHRoaXMuX3RvdWNoU3RhcnRTdGF0ZS52aWV3cG9ydCA9IHVuZGVmaW5lZDtcclxuICAgIHRoaXMuX3RvdWNoU3RhcnRTdGF0ZS5zY2FsZSA9IHVuZGVmaW5lZDtcclxuICAgIHRoaXMuX3RvdWNoU3RhcnRTdGF0ZS5yb3RhdGUgPSB1bmRlZmluZWQ7XHJcbiAgfVxyXG5cclxuICBwcm9jZXNzVG91Y2hFdmVudChldnQpIHtcclxuICAgIC8vIHByb2Nlc3MgcGFuXHJcbiAgICBpZiAoIXRoaXMuX3RvdWNoU3RhcnRTdGF0ZS52aWV3cG9ydCkgeyB0aGlzLl90b3VjaFN0YXJ0U3RhdGUudmlld3BvcnQgPSBPYmplY3QuYXNzaWduKHt9LCB0aGlzLl9yZXNvdXJjZS52aWV3cG9ydCk7IH1cclxuXHJcbiAgICBjb25zdCB2aWV3cG9ydCA9IHRoaXMuX3Jlc291cmNlLnZpZXdwb3J0O1xyXG4gICAgdmlld3BvcnQueCA9IHRoaXMuX3RvdWNoU3RhcnRTdGF0ZS52aWV3cG9ydC54ICsgZXZ0LmRlbHRhWDtcclxuICAgIHZpZXdwb3J0LnkgPSB0aGlzLl90b3VjaFN0YXJ0U3RhdGUudmlld3BvcnQueSArIGV2dC5kZWx0YVk7XHJcblxyXG4gICAgLy8gcHJvY2VzcyBwaW5jaCBpbi9vdXRcclxuICAgIGlmICghdGhpcy5fdG91Y2hTdGFydFN0YXRlLnNjYWxlKSB7IHRoaXMuX3RvdWNoU3RhcnRTdGF0ZS5zY2FsZSA9IHRoaXMuX3Jlc291cmNlLnZpZXdwb3J0LnNjYWxlOyB9XHJcbiAgICBjb25zdCBuZXdTY2FsZSA9IHRoaXMuX3RvdWNoU3RhcnRTdGF0ZS5zY2FsZSAqIGV2dC5zY2FsZTtcclxuICAgIHZpZXdwb3J0LnNjYWxlID0gbmV3U2NhbGUgPiB0aGlzLl9yZXNvdXJjZS5tYXhTY2FsZSA/IHRoaXMuX3Jlc291cmNlLm1heFNjYWxlIDpcclxuICAgICAgbmV3U2NhbGUgPCB0aGlzLl9yZXNvdXJjZS5taW5TY2FsZSA/IHRoaXMuX3Jlc291cmNlLm1pblNjYWxlIDogbmV3U2NhbGU7XHJcblxyXG4gICAgLy8gcHJvY2VzcyByb3RhdGUgbGVmdC9yaWdodFxyXG4gICAgaWYgKCF0aGlzLl90b3VjaFN0YXJ0U3RhdGUucm90YXRlKSB7IHRoaXMuX3RvdWNoU3RhcnRTdGF0ZS5yb3RhdGUgPSB7IHJvdGF0aW9uOiB2aWV3cG9ydC5yb3RhdGlvbiwgc3RhcnRSb3RhdGU6IGV2dC5yb3RhdGlvbiB9OyB9XHJcbiAgICBpZiAoZXZ0LnJvdGF0aW9uICE9PSAwKSB7XHJcbiAgICAgIGNvbnN0IG5ld0FuZ2xlID0gdGhpcy5fdG91Y2hTdGFydFN0YXRlLnJvdGF0ZS5yb3RhdGlvbiArIGV2dC5yb3RhdGlvbiAtIHRoaXMuX3RvdWNoU3RhcnRTdGF0ZS5yb3RhdGUuc3RhcnRSb3RhdGU7XHJcbiAgICAgIHZpZXdwb3J0LnJvdGF0aW9uID0gdGhpcy5jb25maWcucm90YXRlU3RlcHBlciA/IHRvU3F1YXJlQW5nbGUobmV3QW5nbGUpIDogbmV3QW5nbGU7XHJcbiAgICB9XHJcbiAgICB0aGlzLl9kaXJ0eSA9IHRydWU7XHJcbiAgfVxyXG4gIC8vI2VuZHJlZ2lvblxyXG5cclxuICAvLyNyZWdpb24gTW91c2UgRXZlbnRzXHJcbiAgcHJpdmF0ZSBhZGRFdmVudExpc3RlbmVycygpIHtcclxuICAgIC8vIHpvb21pbmdcclxuICAgIHRoaXMuX2xpc3RlbkRlc3Ryb3lMaXN0LnB1c2godGhpcy5fcmVuZGVyZXIubGlzdGVuKHRoaXMuX2NhbnZhcywgJ0RPTU1vdXNlU2Nyb2xsJywgKGV2dCkgPT4gdGhpcy5vbk1vdXNlV2hlZWwoZXZ0KSkpO1xyXG4gICAgdGhpcy5fbGlzdGVuRGVzdHJveUxpc3QucHVzaCh0aGlzLl9yZW5kZXJlci5saXN0ZW4odGhpcy5fY2FudmFzLCAnbW91c2V3aGVlbCcsIChldnQpID0+IHRoaXMub25Nb3VzZVdoZWVsKGV2dCkpKTtcclxuXHJcbiAgICAvLyBzaG93IHRvb2x0aXAgd2hlbiBtb3VzZW92ZXIgaXRcclxuICAgIHRoaXMuX2xpc3RlbkRlc3Ryb3lMaXN0LnB1c2godGhpcy5fcmVuZGVyZXIubGlzdGVuKHRoaXMuX2NhbnZhcywgJ21vdXNlbW92ZScsIChldnQpID0+XHJcbiAgICAgIHRoaXMuY2hlY2tUb29sdGlwQWN0aXZhdGlvbih0aGlzLnNjcmVlblRvQ2FudmFzQ2VudHJlKHsgeDogZXZ0LmNsaWVudFgsIHk6IGV2dC5jbGllbnRZIH0pKVxyXG4gICAgKSk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIG9uTW91c2VXaGVlbChldnQpIHtcclxuICAgIGlmICghZXZ0KSB7IGV2dCA9IGV2ZW50OyB9XHJcbiAgICBldnQucHJldmVudERlZmF1bHQoKTtcclxuICAgIGlmIChldnQuZGV0YWlsIDwgMCB8fCBldnQud2hlZWxEZWx0YSA+IDApIHsgLy8gdXAgLT4gbGFyZ2VyXHJcbiAgICAgIHRoaXMuem9vbUluKCk7XHJcbiAgICB9IGVsc2UgeyAvLyBkb3duIC0+IHNtYWxsZXJcclxuICAgICAgdGhpcy56b29tT3V0KCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGNoZWNrVG9vbHRpcEFjdGl2YXRpb24ocG9zOiB7IHg6IG51bWJlciwgeTogbnVtYmVyIH0pIHtcclxuICAgIHRoaXMuZ2V0VUlFbGVtZW50cygpLmZvckVhY2goeCA9PiB4LmhvdmVyID0gZmFsc2UpO1xyXG4gICAgY29uc3QgYWN0aXZlRWxlbWVudCA9IHRoaXMuZ2V0VUlFbGVtZW50KHBvcyk7XHJcbiAgICBjb25zdCBvbGRUb29sVGlwID0gdGhpcy5fY3VycmVudFRvb2x0aXA7XHJcbiAgICBpZiAoYWN0aXZlRWxlbWVudCAhPT0gbnVsbCkge1xyXG4gICAgICBpZiAodHlwZW9mIGFjdGl2ZUVsZW1lbnQuaG92ZXIgIT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgICAgYWN0aXZlRWxlbWVudC5ob3ZlciA9IHRydWU7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKHR5cGVvZiBhY3RpdmVFbGVtZW50LnRvb2x0aXAgIT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgICAgdGhpcy5fY3VycmVudFRvb2x0aXAgPSBhY3RpdmVFbGVtZW50LnRvb2x0aXA7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGlmIChvbGRUb29sVGlwICE9PSB0aGlzLl9jdXJyZW50VG9vbHRpcCkgeyB0aGlzLl9kaXJ0eSA9IHRydWU7IH1cclxuICB9XHJcbiAgLy8jZW5kcmVnaW9uXHJcblxyXG4gIC8vI3JlZ2lvbiBCdXR0b24gQWN0aW9uc1xyXG5cclxuICBwcml2YXRlIG5leHRQYWdlKCkge1xyXG4gICAgaWYgKCF0aGlzLl9yZXNvdXJjZSkgeyByZXR1cm47IH1cclxuICAgIGlmICh0aGlzLl9yZXNvdXJjZS5jdXJyZW50SXRlbSA+PSB0aGlzLl9yZXNvdXJjZS50b3RhbEl0ZW0pIHsgcmV0dXJuOyB9XHJcbiAgICBpZiAodGhpcy5fcmVzb3VyY2UuY3VycmVudEl0ZW0gPCAxKSB7IHRoaXMuX3Jlc291cmNlLmN1cnJlbnRJdGVtID0gMDsgfVxyXG4gICAgdGhpcy5fcmVzb3VyY2UuY3VycmVudEl0ZW0rKztcclxuICAgIHRoaXMuX3Jlc291cmNlLmxvYWRSZXNvdXJjZSgpO1xyXG4gICAgdGhpcy5fZGlydHkgPSB0cnVlO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBwcmV2aW91c1BhZ2UoKSB7XHJcbiAgICBpZiAoIXRoaXMuX3Jlc291cmNlKSB7IHJldHVybjsgfVxyXG4gICAgaWYgKHRoaXMuX3Jlc291cmNlLmN1cnJlbnRJdGVtIDw9IDEpIHsgcmV0dXJuOyB9XHJcbiAgICBpZiAodGhpcy5fcmVzb3VyY2UuY3VycmVudEl0ZW0gPiB0aGlzLl9yZXNvdXJjZS50b3RhbEl0ZW0pIHsgdGhpcy5fcmVzb3VyY2UuY3VycmVudEl0ZW0gPSB0aGlzLl9yZXNvdXJjZS50b3RhbEl0ZW0gKyAxOyB9XHJcbiAgICB0aGlzLl9yZXNvdXJjZS5jdXJyZW50SXRlbS0tO1xyXG4gICAgdGhpcy5fcmVzb3VyY2UubG9hZFJlc291cmNlKCk7XHJcbiAgICB0aGlzLl9kaXJ0eSA9IHRydWU7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHpvb21JbigpIHtcclxuICAgIGlmICghdGhpcy5fcmVzb3VyY2UpIHsgcmV0dXJuOyB9XHJcbiAgICBjb25zdCBuZXdTY2FsZSA9IHRoaXMuX3Jlc291cmNlLnZpZXdwb3J0LnNjYWxlICogKDEgKyB0aGlzLmNvbmZpZy5zY2FsZVN0ZXApO1xyXG4gICAgdGhpcy5fcmVzb3VyY2Uudmlld3BvcnQuc2NhbGUgPSBuZXdTY2FsZSA+IHRoaXMuX3Jlc291cmNlLm1heFNjYWxlID8gdGhpcy5fcmVzb3VyY2UubWF4U2NhbGUgOiBuZXdTY2FsZTtcclxuICAgIHRoaXMuX2RpcnR5ID0gdHJ1ZTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgem9vbU91dCgpIHtcclxuICAgIGlmICghdGhpcy5fcmVzb3VyY2UpIHsgcmV0dXJuOyB9XHJcbiAgICBjb25zdCBuZXdTY2FsZSA9IHRoaXMuX3Jlc291cmNlLnZpZXdwb3J0LnNjYWxlICogKDEgLSB0aGlzLmNvbmZpZy5zY2FsZVN0ZXApO1xyXG4gICAgdGhpcy5fcmVzb3VyY2Uudmlld3BvcnQuc2NhbGUgPSBuZXdTY2FsZSA8IHRoaXMuX3Jlc291cmNlLm1pblNjYWxlID8gdGhpcy5fcmVzb3VyY2UubWluU2NhbGUgOiBuZXdTY2FsZTtcclxuICAgIHRoaXMuX2RpcnR5ID0gdHJ1ZTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgcm90YXRlTGVmdCgpIHtcclxuICAgIGlmICghdGhpcy5fcmVzb3VyY2UpIHsgcmV0dXJuOyB9XHJcbiAgICBjb25zdCB2aWV3cG9ydCA9IHRoaXMuX3Jlc291cmNlLnZpZXdwb3J0O1xyXG4gICAgdmlld3BvcnQucm90YXRpb24gPSB2aWV3cG9ydC5yb3RhdGlvbiA9PT0gMCA/IDI3MCA6IHZpZXdwb3J0LnJvdGF0aW9uIC0gOTA7XHJcbiAgICB0aGlzLl9kaXJ0eSA9IHRydWU7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHJvdGF0ZVJpZ2h0KCkge1xyXG4gICAgaWYgKCF0aGlzLl9yZXNvdXJjZSkgeyByZXR1cm47IH1cclxuICAgIGNvbnN0IHZpZXdwb3J0ID0gdGhpcy5fcmVzb3VyY2Uudmlld3BvcnQ7XHJcbiAgICB2aWV3cG9ydC5yb3RhdGlvbiA9IHZpZXdwb3J0LnJvdGF0aW9uID09PSAyNzAgPyAwIDogdmlld3BvcnQucm90YXRpb24gKyA5MDtcclxuICAgIHRoaXMuX2RpcnR5ID0gdHJ1ZTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgcmVzZXRJbWFnZSgpIHtcclxuICAgIGlmICghdGhpcy5fcmVzb3VyY2UpIHsgcmV0dXJuOyB9XHJcbiAgICB0aGlzLl9yZXNvdXJjZS5yZXNldFZpZXdwb3J0KHRoaXMuX2NhbnZhcyk7XHJcbiAgICB0aGlzLl9kaXJ0eSA9IHRydWU7XHJcbiAgfVxyXG4gIC8vI2VuZHJlZ2lvblxyXG5cclxuICAvLyNyZWdpb24gRHJhdyBDYW52YXNcclxuICBwcml2YXRlIHVwZGF0ZUNhbnZhcygpIHtcclxuICAgIHRoaXMucmVzZXRJbWFnZSgpO1xyXG5cclxuICAgIC8vIHN0YXJ0IG5ldyByZW5kZXIgbG9vcFxyXG4gICAgdGhpcy5yZW5kZXIoKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgcmVuZGVyKCkge1xyXG4gICAgY29uc3Qgdm0gPSB0aGlzO1xyXG4gICAgLy8gb25seSByZS1yZW5kZXIgaWYgZGlydHlcclxuICAgIGlmICh0aGlzLl9kaXJ0eSAmJiB0aGlzLl9yZXNvdXJjZSkge1xyXG4gICAgICB0aGlzLl9kaXJ0eSA9IGZhbHNlO1xyXG5cclxuICAgICAgY29uc3QgY3R4ID0gdGhpcy5fY29udGV4dDtcclxuICAgICAgY3R4LnNhdmUoKTtcclxuXHJcbiAgICAgIHRoaXMuX3Jlc291cmNlLmRyYXcoY3R4LCB0aGlzLmNvbmZpZywgdGhpcy5fY2FudmFzLCAoKSA9PiB7XHJcbiAgICAgICAgY3R4LnJlc3RvcmUoKTtcclxuXHJcbiAgICAgICAgaWYgKHZtLl9yZXNvdXJjZS5sb2FkZWQpIHtcclxuICAgICAgICAgIC8vIGRyYXcgYnV0dG9uc1xyXG4gICAgICAgICAgdGhpcy5kcmF3QnV0dG9ucyhjdHgpO1xyXG5cclxuICAgICAgICAgIC8vIGRyYXcgcGFnaW5hdG9yXHJcbiAgICAgICAgICBpZiAodGhpcy5fcmVzb3VyY2Uuc2hvd0l0ZW1zUXVhbnRpdHkpIHtcclxuICAgICAgICAgICAgdGhpcy5kcmF3UGFnaW5hdG9yKGN0eCk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB0aGlzLnJlbmRlcigpKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZHJhd0J1dHRvbnMoY3R4KSB7XHJcbiAgICBjb25zdCBwYWRkaW5nID0gdGhpcy5jb25maWcudG9vbHRpcHMucGFkZGluZztcclxuICAgIGNvbnN0IHJhZGl1cyA9IHRoaXMuY29uZmlnLnRvb2x0aXBzLnJhZGl1cztcclxuICAgIGNvbnN0IGdhcCA9IDIgKiByYWRpdXMgKyBwYWRkaW5nO1xyXG4gICAgY29uc3QgeCA9IHRoaXMuX2NhbnZhcy53aWR0aCAtIHJhZGl1cyAtIHBhZGRpbmc7XHJcbiAgICBjb25zdCB5ID0gdGhpcy5fY2FudmFzLmhlaWdodCAtIHJhZGl1cyAtIHBhZGRpbmc7XHJcblxyXG4gICAgLy8gZHJhdyBidXR0b25zXHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuX2J1dHRvbnMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgdGhpcy5fYnV0dG9uc1tpXS5kcmF3KGN0eCwgeCwgeSAtIGdhcCAqIGksIHJhZGl1cyk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gZHJhdyB0b29sdGlwXHJcbiAgICBpZiAodGhpcy5fY3VycmVudFRvb2x0aXAgIT09IG51bGwgJiYgdGhpcy5fY2FudmFzLndpZHRoID4gTUlOX1RPT0xUSVBfV0lEVEhfU1BBQ0UpIHtcclxuICAgICAgY3R4LnNhdmUoKTtcclxuICAgICAgY29uc3QgZm9udFNpemUgPSByYWRpdXM7XHJcbiAgICAgIGN0eC5mb250ID0gZm9udFNpemUgKyAncHggc2Fucy1zZXJpZic7XHJcblxyXG4gICAgICAvLyBjYWxjdWxhdGUgcG9zaXRpb25cclxuICAgICAgY29uc3QgdGV4dFNpemUgPSBjdHgubWVhc3VyZVRleHQodGhpcy5fY3VycmVudFRvb2x0aXApLndpZHRoXHJcbiAgICAgICAgLCByZWN0V2lkdGggPSB0ZXh0U2l6ZSArIHBhZGRpbmdcclxuICAgICAgICAsIHJlY3RIZWlnaHQgPSBmb250U2l6ZSAqIDAuNzAgKyBwYWRkaW5nXHJcbiAgICAgICAgLCByZWN0WCA9IHRoaXMuX2NhbnZhcy53aWR0aFxyXG4gICAgICAgICAgLSAoMiAqIHJhZGl1cyArIDIgKiBwYWRkaW5nKSAvLyBidXR0b25zXHJcbiAgICAgICAgICAtIHJlY3RXaWR0aFxyXG4gICAgICAgICwgcmVjdFkgPSB0aGlzLl9jYW52YXMuaGVpZ2h0IC0gcmVjdEhlaWdodCAtIHBhZGRpbmdcclxuICAgICAgICAsIHRleHRYID0gcmVjdFggKyAwLjUgKiBwYWRkaW5nXHJcbiAgICAgICAgLCB0ZXh0WSA9IHRoaXMuX2NhbnZhcy5oZWlnaHQgLSAxLjUgKiBwYWRkaW5nO1xyXG5cclxuICAgICAgY3R4Lmdsb2JhbEFscGhhID0gdGhpcy5jb25maWcudG9vbHRpcHMuYmdBbHBoYTtcclxuICAgICAgY3R4LmZpbGxTdHlsZSA9IHRoaXMuY29uZmlnLnRvb2x0aXBzLmJnU3R5bGU7XHJcbiAgICAgIHRoaXMuZHJhd1JvdW5kUmVjdGFuZ2xlKGN0eCwgcmVjdFgsIHJlY3RZLCByZWN0V2lkdGgsIHJlY3RIZWlnaHQsIDgsIHRydWUsIGZhbHNlKTtcclxuXHJcbiAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IHRoaXMuY29uZmlnLnRvb2x0aXBzLnRleHRBbHBoYTtcclxuICAgICAgY3R4LmZpbGxTdHlsZSA9IHRoaXMuY29uZmlnLnRvb2x0aXBzLnRleHRTdHlsZTtcclxuICAgICAgY3R4LmZpbGxUZXh0KHRoaXMuX2N1cnJlbnRUb29sdGlwLCB0ZXh0WCwgdGV4dFkpO1xyXG5cclxuICAgICAgY3R4LnJlc3RvcmUoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgZHJhd1BhZ2luYXRvcihjdHgpIHtcclxuICAgIGNvbnN0IHBhZGRpbmcgPSB0aGlzLmNvbmZpZy50b29sdGlwcy5wYWRkaW5nO1xyXG4gICAgY29uc3QgcmFkaXVzID0gdGhpcy5jb25maWcudG9vbHRpcHMucmFkaXVzO1xyXG4gICAgY29uc3QgbGFiZWxXaWR0aCA9IDUwO1xyXG4gICAgY29uc3QgeDEgPSAodGhpcy5fY2FudmFzLndpZHRoIC0gbGFiZWxXaWR0aCkgLyAyIC0gcmFkaXVzIC0gcGFkZGluZzsgLy8gUHJldlBhZ2VCdXR0b25cclxuICAgIGNvbnN0IHgyID0gdGhpcy5fY2FudmFzLndpZHRoIC8gMjsgLy8gTGFiZWxcclxuICAgIGNvbnN0IHgzID0gKHRoaXMuX2NhbnZhcy53aWR0aCArIGxhYmVsV2lkdGgpIC8gMiArIHJhZGl1cyArIHBhZGRpbmc7IC8vIE5leHRQYWdlQnV0dG9uXHJcbiAgICBjb25zdCB5ID0gdGhpcy5fY2FudmFzLmhlaWdodCAtIHJhZGl1cyAtIHBhZGRpbmc7XHJcbiAgICBjb25zdCBsYWJlbCA9IHRoaXMuX3Jlc291cmNlLmN1cnJlbnRJdGVtICsgJy8nICsgdGhpcy5fcmVzb3VyY2UudG90YWxJdGVtO1xyXG4gICAgY29uc3QgZm9udFNpemUgPSAyNTtcclxuXHJcbiAgICBjdHguc2F2ZSgpO1xyXG4gICAgdGhpcy5fYmVmb3JlUGFnZUJ1dHRvbi5kcmF3KGN0eCwgeDEsIHksIHJhZGl1cyk7XHJcbiAgICB0aGlzLl9uZXh0UGFnZUJ1dHRvbi5kcmF3KGN0eCwgeDMsIHksIHJhZGl1cyk7XHJcbiAgICBjdHgucmVzdG9yZSgpO1xyXG5cclxuICAgIGN0eC5zYXZlKCk7XHJcbiAgICBjdHguZm9udCA9IGZvbnRTaXplICsgJ3B4IFZlcmRhbmEnO1xyXG4gICAgY3R4LnRleHRBbGlnbiA9ICdjZW50ZXInO1xyXG4gICAgY3R4LmZpbGxUZXh0KGxhYmVsLCB4MiwgdGhpcy5fY2FudmFzLmhlaWdodCAtIHBhZGRpbmcgLSBmb250U2l6ZSAvIDIsIGxhYmVsV2lkdGgpO1xyXG4gICAgY3R4LnJlc3RvcmUoKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZHJhd1JvdW5kUmVjdGFuZ2xlKGN0eCwgeCwgeSwgd2lkdGgsIGhlaWdodCwgcmFkaXVzLCBmaWxsLCBzdHJva2UpIHtcclxuICAgIHJhZGl1cyA9ICh0eXBlb2YgcmFkaXVzID09PSAnbnVtYmVyJykgPyByYWRpdXMgOiA1O1xyXG4gICAgZmlsbCA9ICh0eXBlb2YgZmlsbCA9PT0gJ2Jvb2xlYW4nKSA/IGZpbGwgOiB0cnVlOyAvLyBmaWxsID0gZGVmYXVsdFxyXG4gICAgc3Ryb2tlID0gKHR5cGVvZiBzdHJva2UgPT09ICdib29sZWFuJykgPyBzdHJva2UgOiBmYWxzZTtcclxuXHJcbiAgICAvLyBkcmF3IHJvdW5kIHJlY3RhbmdsZVxyXG4gICAgY3R4LmJlZ2luUGF0aCgpO1xyXG4gICAgY3R4Lm1vdmVUbyh4ICsgcmFkaXVzLCB5KTtcclxuICAgIGN0eC5saW5lVG8oeCArIHdpZHRoIC0gcmFkaXVzLCB5KTtcclxuICAgIGN0eC5xdWFkcmF0aWNDdXJ2ZVRvKHggKyB3aWR0aCwgeSwgeCArIHdpZHRoLCB5ICsgcmFkaXVzKTtcclxuICAgIGN0eC5saW5lVG8oeCArIHdpZHRoLCB5ICsgaGVpZ2h0IC0gcmFkaXVzKTtcclxuICAgIGN0eC5xdWFkcmF0aWNDdXJ2ZVRvKHggKyB3aWR0aCwgeSArIGhlaWdodCwgeCArIHdpZHRoIC0gcmFkaXVzLCB5ICsgaGVpZ2h0KTtcclxuICAgIGN0eC5saW5lVG8oeCArIHJhZGl1cywgeSArIGhlaWdodCk7XHJcbiAgICBjdHgucXVhZHJhdGljQ3VydmVUbyh4LCB5ICsgaGVpZ2h0LCB4LCB5ICsgaGVpZ2h0IC0gcmFkaXVzKTtcclxuICAgIGN0eC5saW5lVG8oeCwgeSArIHJhZGl1cyk7XHJcbiAgICBjdHgucXVhZHJhdGljQ3VydmVUbyh4LCB5LCB4ICsgcmFkaXVzLCB5KTtcclxuICAgIGN0eC5jbG9zZVBhdGgoKTtcclxuXHJcbiAgICBpZiAoZmlsbCkgeyBjdHguZmlsbCgpOyB9XHJcbiAgICBpZiAoc3Ryb2tlKSB7IGN0eC5zdHJva2UoKTsgfVxyXG4gIH1cclxuXHJcbiAgLy8jZW5kcmVnaW9uXHJcblxyXG4gIC8vI3JlZ2lvbiBVdGlsc1xyXG5cclxuICBwcml2YXRlIGV4dGVuZHNEZWZhdWx0Q29uZmlnKGNmZzogSW1hZ2VWaWV3ZXJDb25maWcpIHtcclxuICAgIGNvbnN0IGRlZmF1bHRDZmcgPSBJTUFHRVZJRVdFUl9DT05GSUdfREVGQVVMVDtcclxuICAgIGNvbnN0IGxvY2FsQ2ZnID0gT2JqZWN0LmFzc2lnbih7fSwgZGVmYXVsdENmZywgY2ZnKTtcclxuICAgIGlmIChjZmcuYnV0dG9uU3R5bGUpIHsgbG9jYWxDZmcuYnV0dG9uU3R5bGUgPSBPYmplY3QuYXNzaWduKGRlZmF1bHRDZmcuYnV0dG9uU3R5bGUsIGNmZy5idXR0b25TdHlsZSk7IH1cclxuICAgIGlmIChjZmcudG9vbHRpcHMpIHsgbG9jYWxDZmcudG9vbHRpcHMgPSBPYmplY3QuYXNzaWduKGRlZmF1bHRDZmcudG9vbHRpcHMsIGNmZy50b29sdGlwcyk7IH1cclxuICAgIGlmIChjZmcubmV4dFBhZ2VCdXR0b24pIHsgbG9jYWxDZmcubmV4dFBhZ2VCdXR0b24gPSBPYmplY3QuYXNzaWduKGRlZmF1bHRDZmcubmV4dFBhZ2VCdXR0b24sIGNmZy5uZXh0UGFnZUJ1dHRvbik7IH1cclxuICAgIGlmIChjZmcuYmVmb3JlUGFnZUJ1dHRvbikgeyBsb2NhbENmZy5iZWZvcmVQYWdlQnV0dG9uID0gT2JqZWN0LmFzc2lnbihkZWZhdWx0Q2ZnLmJlZm9yZVBhZ2VCdXR0b24sIGNmZy5iZWZvcmVQYWdlQnV0dG9uKTsgfVxyXG4gICAgaWYgKGNmZy56b29tT3V0QnV0dG9uKSB7IGxvY2FsQ2ZnLnpvb21PdXRCdXR0b24gPSBPYmplY3QuYXNzaWduKGRlZmF1bHRDZmcuem9vbU91dEJ1dHRvbiwgY2ZnLnpvb21PdXRCdXR0b24pOyB9XHJcbiAgICBpZiAoY2ZnLnpvb21PdXRCdXR0b24pIHsgbG9jYWxDZmcuem9vbU91dEJ1dHRvbiA9IE9iamVjdC5hc3NpZ24oZGVmYXVsdENmZy56b29tT3V0QnV0dG9uLCBjZmcuem9vbU91dEJ1dHRvbik7IH1cclxuICAgIGlmIChjZmcuem9vbUluQnV0dG9uKSB7IGxvY2FsQ2ZnLnpvb21JbkJ1dHRvbiA9IE9iamVjdC5hc3NpZ24oZGVmYXVsdENmZy56b29tSW5CdXR0b24sIGNmZy56b29tSW5CdXR0b24pOyB9XHJcbiAgICBpZiAoY2ZnLnJvdGF0ZUxlZnRCdXR0b24pIHsgbG9jYWxDZmcucm90YXRlTGVmdEJ1dHRvbiA9IE9iamVjdC5hc3NpZ24oZGVmYXVsdENmZy5yb3RhdGVMZWZ0QnV0dG9uLCBjZmcucm90YXRlTGVmdEJ1dHRvbik7IH1cclxuICAgIGlmIChjZmcucm90YXRlUmlnaHRCdXR0b24pIHsgbG9jYWxDZmcucm90YXRlUmlnaHRCdXR0b24gPSBPYmplY3QuYXNzaWduKGRlZmF1bHRDZmcucm90YXRlUmlnaHRCdXR0b24sIGNmZy5yb3RhdGVSaWdodEJ1dHRvbik7IH1cclxuICAgIGlmIChjZmcucmVzZXRCdXR0b24pIHsgbG9jYWxDZmcucmVzZXRCdXR0b24gPSBPYmplY3QuYXNzaWduKGRlZmF1bHRDZmcucmVzZXRCdXR0b24sIGNmZy5yZXNldEJ1dHRvbik7IH1cclxuICAgIHJldHVybiBsb2NhbENmZztcclxuICB9XHJcblxyXG4gIHByaXZhdGUgc2NyZWVuVG9DYW52YXNDZW50cmUocG9zOiB7IHg6IG51bWJlciwgeTogbnVtYmVyIH0pIHtcclxuICAgIGNvbnN0IHJlY3QgPSB0aGlzLl9jYW52YXMuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XHJcbiAgICByZXR1cm4geyB4OiBwb3MueCAtIHJlY3QubGVmdCwgeTogcG9zLnkgLSByZWN0LnRvcCB9O1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBnZXRVSUVsZW1lbnRzKCk6IEJ1dHRvbltdIHtcclxuICAgIGNvbnN0IGhvdmVyRWxlbWVudHMgPSB0aGlzLl9idXR0b25zLnNsaWNlKCk7XHJcbiAgICBob3ZlckVsZW1lbnRzLnB1c2godGhpcy5fbmV4dFBhZ2VCdXR0b24pO1xyXG4gICAgaG92ZXJFbGVtZW50cy5wdXNoKHRoaXMuX2JlZm9yZVBhZ2VCdXR0b24pO1xyXG4gICAgcmV0dXJuIGhvdmVyRWxlbWVudHM7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGdldFVJRWxlbWVudChwb3M6IHsgeDogbnVtYmVyLCB5OiBudW1iZXIgfSkge1xyXG4gICAgY29uc3QgYWN0aXZlVUlFbGVtZW50ID0gdGhpcy5nZXRVSUVsZW1lbnRzKCkuZmlsdGVyKCh1aUVsZW1lbnQpID0+IHtcclxuICAgICAgcmV0dXJuIHVpRWxlbWVudC5pc1dpdGhpbkJvdW5kcyhwb3MueCwgcG9zLnkpO1xyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gKGFjdGl2ZVVJRWxlbWVudC5sZW5ndGggPiAwKSA/IGFjdGl2ZVVJRWxlbWVudFswXSA6IG51bGw7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGlzSW1hZ2UoZmlsZTogc3RyaW5nIHwgRmlsZSkge1xyXG4gICAgaWYgKHRoaXMuX2ZpbGV0eXBlICYmIHRoaXMuX2ZpbGV0eXBlLnRvTG93ZXJDYXNlKCkgPT09ICdpbWFnZScpIHsgcmV0dXJuIHRydWU7IH1cclxuICAgIHJldHVybiB0ZXN0RmlsZShmaWxlLCAnXFxcXC4ocG5nfGpwZ3xqcGVnfGdpZil8aW1hZ2UvcG5nJyk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGlzUGRmKGZpbGU6IHN0cmluZyB8IEZpbGUpIHtcclxuICAgIGlmICh0aGlzLl9maWxldHlwZSAmJiB0aGlzLl9maWxldHlwZS50b0xvd2VyQ2FzZSgpID09PSAncGRmJykgeyByZXR1cm4gdHJ1ZTsgfVxyXG4gICAgcmV0dXJuIHRlc3RGaWxlKGZpbGUsICdcXFxcLihwZGYpfGFwcGxpY2F0aW9uL3BkZicpO1xyXG4gIH1cclxuICAvLyNlbmRyZWdpb25cclxufVxyXG5cclxuZnVuY3Rpb24gdGVzdEZpbGUoZmlsZTogc3RyaW5nIHwgRmlsZSwgcmVnZXhUZXN0OiBzdHJpbmcpIHtcclxuICBpZiAoIWZpbGUpIHsgcmV0dXJuIGZhbHNlOyB9XHJcbiAgY29uc3QgbmFtZSA9IGZpbGUgaW5zdGFuY2VvZiBGaWxlID8gZmlsZS5uYW1lIDogZmlsZTtcclxuICByZXR1cm4gbmFtZS50b0xvd2VyQ2FzZSgpLm1hdGNoKHJlZ2V4VGVzdCkgIT09IG51bGw7XHJcbn1cclxuIl19